<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2023-07-07T23:37:59+09:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">기록하는 개발자</title><subtitle>기록소</subtitle><author><name>Jung MinGyu</name></author><entry><title type="html">그래프 그리기 위한것</title><link href="http://localhost:4000/%EB%AA%A8%EC%9D%98%ED%95%B4%ED%82%B9%EC%88%98%EC%97%85/%EC%98%A4%EC%A7%81%EB%A1%9C%EC%BB%AC/" rel="alternate" type="text/html" title="그래프 그리기 위한것" /><published>2099-09-09T00:00:00+09:00</published><updated>2099-12-31T23:13:00+09:00</updated><id>http://localhost:4000/%EB%AA%A8%EC%9D%98%ED%95%B4%ED%82%B9%EC%88%98%EC%97%85/%EC%98%A4%EC%A7%81%EB%A1%9C%EC%BB%AC</id><content type="html" xml:base="http://localhost:4000/%EB%AA%A8%EC%9D%98%ED%95%B4%ED%82%B9%EC%88%98%EC%97%85/%EC%98%A4%EC%A7%81%EB%A1%9C%EC%BB%AC/"><![CDATA[<pre><code class="language-mermaild!">sequenceDiagram
</code></pre>]]></content><author><name>Jung MinGyu</name></author><category term="모의해킹수업" /><category term="웹 구조" /><summary type="html"><![CDATA[오직 로컬에서만 되냐 젠장]]></summary></entry><entry><title type="html">주통기반 Web 취약점 시나리오 (수정중)</title><link href="http://localhost:4000/%EC%A3%BC%ED%86%B5%EA%B8%B0%EB%B0%98%EA%B3%B5%EA%B2%A9%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4%EC%A0%95%EB%A6%AC/" rel="alternate" type="text/html" title="주통기반 Web 취약점 시나리오 (수정중)" /><published>2023-07-02T00:00:00+09:00</published><updated>2023-07-07T23:13:00+09:00</updated><id>http://localhost:4000/%EC%A3%BC%ED%86%B5%EA%B8%B0%EB%B0%98%EA%B3%B5%EA%B2%A9%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4%EC%A0%95%EB%A6%AC</id><content type="html" xml:base="http://localhost:4000/%EC%A3%BC%ED%86%B5%EA%B8%B0%EB%B0%98%EA%B3%B5%EA%B2%A9%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4%EC%A0%95%EB%A6%AC/"><![CDATA[<h2 id="3-ldap-인젝션">3. LDAP 인젝션</h2>

<h3 id="ldap">LDAP</h3>
<ul>
  <li>작은 DB 이다.</li>
  <li>간단한 로그인 인증에 사용된다.</li>
</ul>

<h3 id="취약점-시나리오">취약점 시나리오</h3>
<ul>
  <li>로그인 인증을 우회하기. 비인가 사용자가 시스템에 접속할 수 있습니다.</li>
</ul>

<h2 id="4-운영체제-명령어-실행">4. 운영체제 명령어 실행</h2>
<ul>
  <li>command injection</li>
  <li>예를 들어 nslookup ( DNS 에 도메인 정보를 요청 ) 명령을 내부적으로 수행하는 사이트가 있다고 하자. 도메인 검색 페이지에서 도메인 만을 입력하는 것이 아닌 그 다음의 명령을 이어 붙여 다음 명령을 수행시키는 공격이다.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nslookup 도메인명;ls
</code></pre></div></div>

<h3 id="취약점-시나리오-1">취약점 시나리오</h3>
<ul>
  <li>서버에 악영향을 미치는 명령을 실행시킬 수 있다.</li>
</ul>

<h2 id="5-sql-injection">5. SQL Injection</h2>
<ul>
  <li>임의의 SQL 문을 삽입하는 공격이다.</li>
</ul>

<h3 id="취약점-시나리오-2">취약점 시나리오</h3>
<ul>
  <li>DB 에 저장된 정보를 탈취할 수 있다.</li>
  <li>인증을 우회할 수 있다.</li>
</ul>

<h2 id="6-ssi-injection">6. SSI Injection</h2>
<ul>
  <li>ssi(Server Side Include) 란 WAS(php, jsp) 가 나오기 전에 동적 페이지를 만들 때 사용되었다.</li>
  <li>ssi 로 만들어진 코드를 삽입하는 공격이다. 확장자는 shtml 이다. ssi 지시어를 실행시켜 발생하는 취약점이다.</li>
  <li>현재는 거의 없다.</li>
</ul>

<h3 id="취약점-시나리오-3">취약점 시나리오</h3>
<ul>
  <li>악의적인 커맨드 명령어를 실행시킬 수 있다.</li>
</ul>

<h2 id="7-xpath-injection">7. XPath Injection</h2>
<ul>
  <li>XML (Extensible Markup Language)의 xpath 에서 발생하는 오류이다.</li>
  <li>XML은 네트워크 통신을 할 때 쓰였지만 현재는 JSON 형태로 데이터를 전달한다.</li>
</ul>

<h3 id="취약점-시나리오-4">취약점 시나리오.</h3>
<ul>
  <li>XPath 로 구성된 로그인 페이지에서 인증을 우회할 수 있다.</li>
</ul>

<h2 id="9-정보-누출">9. 정보 누출</h2>

<h3 id="개인-정보-누출">개인 정보 누출</h3>
<ul>
  <li>사용자에게는 개인 정보의 일부만 보여주지만, 서버에서 개인정보 모두를 전송한다. 불필요한 정보까지 노출될 수 있다.</li>
</ul>

<h3 id="서버-정보-누출">서버 정보 누출</h3>
<ul>
  <li>서버 버전. 어떠한 WAS 을 쓰는지 확인할 수 있다.</li>
  <li>이러한 정보로 해당 버전에 취약점이 존재하는지 확인할 수 있다.</li>
</ul>

<h2 id="11-크로스사이트-스크립팅">11. 크로스사이트 스크립팅</h2>
<ul>
  <li>클라이언트 측 스크립트를 삽입하는 공격이다.</li>
  <li>클라이언트 측에서 악의적인 스크립트가 실행되게 하는 공격이다.</li>
</ul>

<h3 id="stored-xss">Stored XSS</h3>
<ul>
  <li>게시글, 게시판과 같은 곳에서 발생한다.</li>
</ul>

<h4 id="취약점-시나리오-5">취약점 시나리오</h4>
<ol>
  <li>공격자는 악의적인 스크립트를 삽입한 게시글을 작성한다.</li>
  <li>방문자가 악성 게시글에 방문하면 사용자 브라우저에서 악성 스크립트가 동작하여 악의적인 행위를 수행한다. ( 쿠키 세션 ID값을 공격자 서버로 전송 )</li>
</ol>

<h3 id="reflected-xss">Reflected XSS</h3>
<ul>
  <li>사용자의 요청 파라미터 값을 그대로 보여주는 페이지에서 발생한다.</li>
</ul>

<h4 id="취약점-시나리오-6">취약점 시나리오</h4>
<ol>
  <li>공격자는 악성 스크립트를 삽입한 악성 링크를 만든다.</li>
  <li>사용자가 악성 링크를 클릭하도록 유도한다.</li>
  <li>사용자가 악성 링크를 클릭하여 들어가면 삽입한 악성 스크립트가 사용자 브라우저에서 동작하여 악의적인 행위를 수행한다. (키로거 삽입, 세션 ID 값 탈취)</li>
</ol>

<h2 id="15-csrf">15. CSRF</h2>
<ul>
  <li>사용자가 임의의 요청을 보내도록하는 공격이다.</li>
  <li>즉 사용자는 자신도 모르게 임의의 요청을 보내게 된다.</li>
  <li>주로 XSS 공격과 같이 CSRF공격을 진행한다.</li>
</ul>

<h3 id="취약점-시나리오-7">취약점 시나리오</h3>
<ol>
  <li>공격자는 XSS 취약점을 이용하여 악의적인 요청을 보내는 게시글을 작성한다.</li>
  <li>사용자가 악성 게시글에 방문하면 자신도 모르게 서버로 악의적인 요청을 보내게된다.</li>
</ol>

<h2 id="19-세션-고정">19. 세션 고정</h2>
<ul>
  <li>로그인 전과 로그인 후의 세션 ID값이 동일한 취약점이다.</li>
  <li>즉 서버에서 세션 ID값을 새로 발급해주는 것이 아닌 기존 유저가 가지고 있는 세션 ID값을 이용하여 로그인 여부를 확인한다.</li>
</ul>

<h3 id="취약점-시나리오-8">취약점 시나리오</h3>
<ol>
  <li>Reflected XSS 취약점을 이용하여 로그인 페이지에 스크립트를 사용하여 피해자의 쿠키 세션 ID값을 공격자 세션 ID 값으로 바꾼다.</li>
  <li>피해자가 악성 링크를 이용하여 로그인을 하여도 세션 ID값이 바뀌지 않아 공격자는 피해자로 로그인 인증우회 한다.</li>
  <li>이렇게 로그인을 우회하여 피해자의 정보 탈취 및 권한 우회가 가능하다.</li>
</ol>

<h2 id="22-파일-업로드">22. 파일 업로드</h2>
<ul>
  <li>임의의 파일을 업로드하고 실행 시키는 공격이다.</li>
  <li>악의적인 웹 쉘 파일을 업로드 및 실행하여 서버에 치명적인 영향을 미칠 수 있다.</li>
</ul>

<h3 id="취약점-시나리오-9">취약점 시나리오</h3>
<ol>
  <li>공격자는 서버에 웹 쉘 파일을 업로드한다.</li>
  <li>공격자는 웹 쉘 파일을 실행시켜 서버에서 민감한 파일 추출할 수 있다. (db 계정 정보, 웹 서버 코드)</li>
</ol>

<h2 id="23-파일-다운로드">23. 파일 다운로드</h2>
<ul>
  <li>서버의 임의의 파일을 다운로드 받는 공격이다.</li>
  <li>서버의 다운로드 페이지가 구현되어 있을 때 발생한다. (../down?file=test.png)</li>
  <li>file traversal 취약점을 이용하여 서버의 민감한 정보를 탈취할 수 있다.</li>
</ul>

<h3 id="취약점-시나리오-10">취약점 시나리오</h3>
<ol>
  <li>공격자는 file traversal 공격을 이용하여 서버의 민감한 파일을 탈취한다.</li>
  <li>공격자는 이러한 민감한 파일을 분석하여 또 다른 취약점을 발견할 수 있다.</li>
</ol>]]></content><author><name>Jung MinGyu</name></author><category term="LDAP" /><category term="Comman Injection" /><category term="SQL Injection" /><category term="SSI Injection" /><category term="XPath Injection" /><category term="XSS" /><category term="CSRF" /><category term="File Upload" /><category term="File Download" /><summary type="html"><![CDATA[주통기반 Web 취약점 시나리오를 정리해보자]]></summary></entry><entry><title type="html">Buffer Overflow 와 Format String Bug</title><link href="http://localhost:4000/BoF%EC%99%80FSB/" rel="alternate" type="text/html" title="Buffer Overflow 와 Format String Bug" /><published>2023-06-30T00:00:00+09:00</published><updated>2023-06-30T23:13:00+09:00</updated><id>http://localhost:4000/BoF%EC%99%80FSB</id><content type="html" xml:base="http://localhost:4000/BoF%EC%99%80FSB/"><![CDATA[<h2 id="프로세스-구조">프로세스 구조</h2>
<p><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/69baa543-8e82-4d24-bd92-5683a77d051b" alt="Pasted image 20230630182437" /></p>

<h3 id="code">CODE</h3>
<ul>
  <li>TEXT 영역이라고도 한다.</li>
  <li>실행할 프로그램의 코드가 저장되어 있다.</li>
  <li>CPU는 코드 영역에 저장된 명령어를 하나씩 가져가서 처리한다.</li>
</ul>

<h3 id="data">DATA</h3>
<ul>
  <li>프로그램의 전역 변수와 정적(static) 변수가 저장되는 영역이다.</li>
  <li>프로그램의 시작과 함께 할당되며, 프로그램이 종료되면 소멸한다.</li>
</ul>

<h3 id="heap">HEAP</h3>
<ul>
  <li>사용자가 직접 관리할 수 있는 메모리 영역이다.</li>
  <li>사용자에 의해 동적으로 메모리 공각이 할당되고 해제된다.</li>
  <li>메모리의 낮은 주소에서 높은 주소로 할당된다.</li>
  <li>c 언어의 malloc</li>
</ul>

<h3 id="stack">STACK</h3>
<ul>
  <li>함수의 호출과 함께 할당되며, 함수의 호출이 완료되면 소멸한다.</li>
  <li>함수의 호출과 관계된 지역변수와 매개변수가 저장된다.</li>
  <li>메모리의 높은 주소에서 낮은 주소로 할당된다.</li>
</ul>

<h3 id="stack-할당-예시">STACK 할당 예시</h3>
<p><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/ed4d540f-8c6d-4225-98ad-41efe673736f" alt="Pasted image 20230630202730" /></p>

<h2 id="buffer-overflow">Buffer Overflow</h2>
<ul>
  <li>할당된 버퍼의 크기를 초과한 데이터가 입력되어 인접한 다른 메모리 정보를 덧쓰는 현상이다.</li>
  <li>프로세스가 데이터를 버퍼에 저장할 때 프로그래머가 지정한 곳 바깥에 저장하는 것을 의미한다.</li>
  <li>할당받은 공간보다 더 많은 입력을 받아 발생한다.</li>
  <li>return address 를 변경하여 악의적인 코드를 실행시킬 수 있다.</li>
</ul>

<h3 id="bof-발생-예시">BoF 발생 예시</h3>
<ul>
  <li>32 bit 시스템이라고 가정한다.</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span><span class="n">buf</span><span class="p">);</span>
	<span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>입력 전.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/5c1f1895-e12f-4ef6-bd0e-fd0d0ea01b1c" alt="Pasted image 20230630211112" /></li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">AAAAAAAAAAAAAAAAAA</code> 입력을 한다</p>
  </li>
  <li>
    <p>입력 후.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/2d36546a-6267-422b-a102-f6c57b67369e" alt="Pasted image 20230630211134" /></p>
  </li>
  <li>할당 받은 버퍼 크기를 넘는 입력을 받아 인접한 메모리의 정보가 덧씌워졌다.</li>
  <li>Buffer Overflow 공격을 통해 리턴 주소를 공격자 마음대로 수정할 수 있다.</li>
</ul>

<h2 id="포맷-스트링--fsb-">포맷 스트링 ( FSB )</h2>
<ul>
  <li>Format String Bug</li>
  <li>입력 값에 포맷 스트링을 넣으면 문자로 취급하는게 아닌, 서식 문자로 취급하여 취약점이 일어날 수 있다.</li>
  <li>포맷팅 문자열에서 발생한다.</li>
  <li>메모리 안의 정보를 누출시킬 수 있다. 즉 스택 메모리의 정보를 얻을 수 있다.</li>
  <li>잘못된 메모리 주소에 접근을 시도하여 프로그램을 중단시킬 수 있다.</li>
  <li>%n 을 이용하여 스택 값을 변조할 수 있다. 즉 리턴 주소 값을 수정하여 악의적인 코드를 실행시킬 수 있다.</li>
</ul>

<h3 id="예시">예시</h3>
<ul>
  <li>코드</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">){</span>
	<span class="n">printf</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>입력</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./example "%s%s%s%s"
</code></pre></div></div>

<ul>
  <li>
    <p>스택에 있는 메모리 정보를 노출 시킨다.</p>
  </li>
  <li>
    <p>입력</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./example "%p%p%p%p"
</code></pre></div></div>

<ul>
  <li>실행하는 순간의 스택에 있는 메모리 주소를 출력해준다.</li>
</ul>

<h2 id="참고-사이트">참고 사이트</h2>
<ul>
  <li><a href="https://blue-pxngxxn.tistory.com/entry/%EC%B7%A8%EC%95%BD%EC%A0%90%EA%B3%B5%EA%B2%A9-Format-String-Attack-FSB">Format String Attack (FSB) (tistory.com)</a></li>
  <li><a href="http://www.tcpschool.com/c/c_memory_stackframe">코딩의 시작, TCP School</a></li>
  <li><a href="http://www.tcpschool.com/c/c_memory_structure">코딩의 시작, TCP School</a></li>
  <li><a href="https://zangzangs.tistory.com/107">프로세스 메모리 구조 (코드, 데이터, 스텍, 힙) (tistory.com)</a></li>
  <li><a href="https://ko.wikipedia.org/wiki/%EB%B2%84%ED%8D%BC_%EC%98%A4%EB%B2%84%ED%94%8C%EB%A1%9C">버퍼 오버플로 - 위키백과, 우리 모두의 백과사전 (wikipedia.org)</a></li>
</ul>]]></content><author><name>Jung MinGyu</name></author><category term="BOF" /><category term="FSB" /><summary type="html"><![CDATA[bof 와 fsb 에 대하여 알아보자.]]></summary></entry><entry><title type="html">웹 서버 개발 (19) 비회원 문의 게시판</title><link href="http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C19%EB%B9%84%ED%9A%8C%EC%9B%90%EA%B2%8C%EC%8B%9C%ED%8C%90/" rel="alternate" type="text/html" title="웹 서버 개발 (19) 비회원 문의 게시판" /><published>2023-06-22T00:00:00+09:00</published><updated>2023-06-22T23:13:00+09:00</updated><id>http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C19%EB%B9%84%ED%9A%8C%EC%9B%90%EA%B2%8C%EC%8B%9C%ED%8C%90</id><content type="html" xml:base="http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C19%EB%B9%84%ED%9A%8C%EC%9B%90%EA%B2%8C%EC%8B%9C%ED%8C%90/"><![CDATA[<h2 id="비회원-문의-게시판">비회원 문의 게시판</h2>
<ul>
  <li>회원 가입을 하지 않아도 사용자는 문의 게시판을 이용할 수 있다.</li>
  <li>비밀번호를 통해 본인이 쓴 글만 삭제할 수 있다.</li>
  <li>최대 3개의 첨부파일을 업로드할 수 있다.</li>
</ul>

<h2 id="sql-비회원-문의-게시글">SQL 비회원 문의 게시글</h2>

<h3 id="table-만들기">Table 만들기</h3>
<ul>
  <li>sid</li>
  <li>gen_time ( 생성 시간 )</li>
  <li>title</li>
  <li>main_text</li>
  <li>salt</li>
  <li>passwd</li>
  <li>file cnt</li>
  <li>file sids</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">no_member_notice_board</span> <span class="p">(</span>
	<span class="n">sid</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
	<span class="n">gen_time</span> <span class="n">number</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
	<span class="n">title</span> <span class="n">varchar2</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
	<span class="n">main_text</span> <span class="k">clob</span><span class="p">,</span>
	<span class="n">salt</span> <span class="n">varchar2</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
	<span class="n">password</span> <span class="n">varchar2</span><span class="p">(</span><span class="mi">150</span><span class="p">),</span>
	<span class="n">file_cnt</span> <span class="n">number</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">default</span> <span class="mi">0</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
	<span class="n">file_sids</span> <span class="n">nvarchar2</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">default</span> <span class="s1">'[]'</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>
</code></pre></div></div>

<h3 id="비회원-문의글-작성">비회원 문의글 작성</h3>
<ul>
  <li>일단 문의글부터 작성한다. 파일 저장은 update 를 이용하여 저장해 줄 것이다.</li>
  <li>문의글 생성일, 제목, 본문, 비밀번호를 입력하여야 한다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">insert</span> <span class="k">into</span> 
<span class="n">no_member_notice_board</span> <span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">gen_time</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">main_text</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="k">select</span> <span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="n">salt</span><span class="p">,</span><span class="n">standard_hash</span><span class="p">(</span><span class="n">salt</span><span class="o">||?</span><span class="p">,</span><span class="s1">'SHA512'</span><span class="p">)</span> <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="n">DBMS_RANDOM</span><span class="p">.</span><span class="n">STRING</span><span class="p">(</span><span class="s1">'P'</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">salt</span> <span class="k">from</span> <span class="n">dual</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>파일 sid 목록들과 첨부파일 수를 동시에 저장한다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">insert</span> <span class="k">into</span> 
<span class="n">no_member_notice_board</span> <span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">gen_time</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">main_text</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">file_cnt</span><span class="p">,</span><span class="n">file_sids</span><span class="p">)</span>
<span class="k">select</span> <span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="n">salt</span><span class="p">,</span><span class="n">standard_hash</span><span class="p">(</span><span class="n">salt</span><span class="o">||?</span><span class="p">,</span><span class="s1">'SHA512'</span><span class="p">),</span><span class="o">?</span><span class="p">,</span><span class="o">?</span> <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="n">DBMS_RANDOM</span><span class="p">.</span><span class="n">STRING</span><span class="p">(</span><span class="s1">'P'</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">salt</span> <span class="k">from</span> <span class="n">dual</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="dao-코드">DAO 코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoMemberNoticeBoardDAO</span> <span class="o">{</span>
<span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">long</span> <span class="nf">addNotice</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">,</span> <span class="nc">String</span> <span class="n">mainText</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">long</span> <span class="n">re</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"insert into "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" (sid, gen_time, title, main_text, salt, password) "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"select "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" ?,?,?,?,salt,standard_hash(salt||?,'SHA512') from (select DBMS_RANDOM.STRING('P', 30) as salt from dual)"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="n">getSid</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">re</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">title</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="n">mainText</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">long</span> <span class="nf">addNotice2</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">,</span> <span class="nc">String</span> <span class="n">mainText</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">,</span><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">arr</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">long</span> <span class="n">re</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"insert into "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" (sid, gen_time, title, main_text, salt, password, file_cnt,file_sids) "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"select "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" ?,?,?,?,salt,standard_hash(salt||?,'SHA512'),?,? from (select DBMS_RANDOM.STRING('P', 30) as salt from dual)"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="n">getSid</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">re</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">title</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="n">mainText</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="n">arr</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="n">arr</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="문의글-목록-가져오기">문의글 목록 가져오기</h3>
<ul>
  <li>문의글 생성 시간으로 정렬해준다.</li>
  <li>모든 문의 글을 가져오지 않고 특정 갯수의 문의 글을 가지고 온다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">no_member_notice_board</span> <span class="k">order</span> <span class="k">by</span> <span class="n">gen_time</span> <span class="k">desc</span> <span class="k">OFFSET</span> <span class="o">?</span> <span class="k">ROWS</span> <span class="k">FETCH</span> <span class="k">NEXT</span> <span class="o">?</span> <span class="k">ROWS</span> <span class="k">ONLY</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="dao-코드-1">DAO 코드</h4>
<ul>
  <li>문의 게시글 목록을 가지고 온다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">NoMemberNoticeBoard</span><span class="o">&gt;</span> <span class="nf">getNoticeList</span><span class="o">(</span><span class="kt">long</span> <span class="n">start</span><span class="o">,</span> <span class="kt">long</span> <span class="n">number</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">NoMemberNoticeBoard</span><span class="o">&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"select * from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" order by gen_time desc OFFSET ? ROWS FETCH NEXT ? ROWS ONLY"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">start</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">number</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">while</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">next</span><span class="o">()){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span><span class="o">.</span><span class="na">add</span><span class="o">(</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoard</span><span class="o">(</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">result</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">result</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">result</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">result</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">)</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">NoMemberNoticeBoard</span><span class="o">&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="문의글-파일-sid-목록-가지고-오기">문의글 파일 sid 목록 가지고 오기</h3>
<ul>
  <li>문의글의 첨부파일 sid 목록을 리스트 형태로 가지고온다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">no_member_notice_board</span><span class="err"> </span><span class="k">where</span> <span class="n">sid</span><span class="o">=?</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="dao-코드-2">DAO 코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="c1">// get file sid list</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="nf">getFileSidList</span><span class="o">(</span><span class="kt">long</span> <span class="n">noticeSid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"select file_sids from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">noticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">String</span> <span class="n">listStr</span> <span class="o">=</span> <span class="s">"[]"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">re</span><span class="o">.</span><span class="na">next</span><span class="o">()){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">listStr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="n">strToArrayList</span><span class="o">(</span><span class="n">listStr</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">fileSidList</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="kd">private</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="nf">strToArrayList</span><span class="o">(</span><span class="nc">String</span> <span class="n">listStr</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">arr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">listStr</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">arr</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">listStr</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">listStr</span><span class="o">.</span><span class="na">length</span><span class="o">()-</span><span class="mi">1</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="s">", "</span><span class="o">)).</span><span class="na">map</span><span class="o">(</span><span class="nl">Long:</span><span class="o">:</span><span class="n">parseLong</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">()));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">arr</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="문의글-갯수-구하기">문의글 갯수 구하기</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span> <span class="k">from</span> <span class="n">no_member_notice_board</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="dao-코드-3">DAO 코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">(){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"select count(sid) from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">next</span><span class="o">()){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">cnt</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="문의글-읽기">문의글 읽기</h3>
<ul>
  <li>비밀번호를 맞게 입력해야 비회원이 작성한 게시글을 읽을 수 있다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">no_member_notice_board</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=?</span> <span class="k">and</span> <span class="n">password</span><span class="o">=</span><span class="n">standard_hash</span><span class="p">(</span><span class="n">salt</span><span class="o">||?</span><span class="p">,</span><span class="s1">'SHA512'</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="dao-코드-4">DAO 코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="nc">NoMemberNoticeBoard</span> <span class="nf">getNoitceBoard</span><span class="o">(</span><span class="kt">long</span> <span class="n">sid</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">NoMemberNoticeBoard</span> <span class="n">noMemberNoticeBoard</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"select * from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" where sid=? and password=standard_hash(salt||?,'SHA512')"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">sid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">next</span><span class="o">()){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noMemberNoticeBoard</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoard</span><span class="o">(</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">result</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">result</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">result</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">result</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noMemberNoticeBoard</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">noMemberNoticeBoard</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="문의글-삭제">문의글 삭제</h3>
<ul>
  <li>비밀번호를 맞게 입력해야 비회원 게시글을 삭제할 수 있다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">delete</span> <span class="k">from</span> <span class="n">no_member_notice_board</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=?</span> <span class="k">and</span> <span class="n">password</span><span class="o">=</span><span class="n">standard_hash</span><span class="p">(</span><span class="n">salt</span><span class="o">||?</span><span class="p">,</span><span class="s1">'SHA512'</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="dao-코드-5">DAO 코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">noticeDelete</span><span class="o">(</span><span class="kt">long</span> <span class="n">sid</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 첨부 파일 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardFileDAO</span><span class="o">(</span><span class="n">context</span><span class="o">).</span><span class="na">deleteNoticeFile</span><span class="o">(</span><span class="n">sid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"delete from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" where sid=? and password=standard_hash(salt||?,'SHA512')"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">sid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="문의글-수정하기">문의글 수정하기</h3>
<ul>
  <li>제목과 본문 수정하기.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">update</span> <span class="n">no_member_notice_board</span> <span class="k">set</span> <span class="n">gen_time</span><span class="o">=?</span><span class="p">,</span><span class="n">title</span><span class="o">=?</span><span class="p">,</span><span class="n">main_text</span><span class="o">=?</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=?</span> <span class="k">and</span> <span class="n">password</span><span class="o">=</span><span class="n">standard_hash</span><span class="p">(</span><span class="n">salt</span><span class="o">||?</span><span class="p">,</span><span class="s1">'SHA512'</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>업로드 파일 sid를 문의 글 리스트에 추가하기.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">update</span> <span class="n">no_member_notice_board</span> <span class="k">set</span> <span class="n">file_cnt</span><span class="o">=?</span><span class="p">,</span><span class="n">file_sids</span><span class="o">=?</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=?</span> <span class="k">and</span> <span class="n">password</span><span class="o">=</span><span class="n">standard_hash</span><span class="p">(</span><span class="n">salt</span><span class="o">||</span><span class="s1">'a'</span><span class="p">,</span><span class="s1">'SHA512'</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="dao-코드-6">DAO 코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">long</span> <span class="nf">noticeModifySave</span><span class="o">(</span><span class="kt">long</span> <span class="n">sid</span><span class="o">,</span> <span class="nc">String</span> <span class="n">prePassword</span><span class="o">,</span> <span class="nc">String</span> <span class="n">title</span><span class="o">,</span> <span class="nc">String</span> <span class="n">mainText</span><span class="o">,</span> <span class="nc">String</span> <span class="n">newPassword</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비번 일치 확인</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">long</span> <span class="n">newSid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">preNotice</span> <span class="o">=</span> <span class="n">getNoitceBoard</span><span class="o">(</span><span class="n">sid</span><span class="o">,</span> <span class="n">prePassword</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"일치 확인"</span><span class="o">+</span><span class="n">preNotice</span><span class="o">+</span><span class="s">" "</span><span class="o">+</span><span class="n">sid</span><span class="o">+</span><span class="s">" "</span><span class="o">+</span><span class="n">prePassword</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">preNotice</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span> <span class="c1">// 비번 일치 안함</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">getFileSidList</span><span class="o">(</span><span class="n">sid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 새로운 문의 글 생성</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">newSid</span> <span class="o">=</span> <span class="n">addNotice2</span><span class="o">(</span><span class="n">title</span><span class="o">,</span> <span class="n">mainText</span><span class="o">,</span> <span class="n">newPassword</span><span class="o">,</span><span class="n">arr</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">newSid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 이전에 저장된 파일 새로운 글로 이전</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardFileDAO</span><span class="o">(</span><span class="n">context</span><span class="o">).</span><span class="na">changeNoticeSid</span><span class="o">(</span><span class="n">sid</span><span class="o">,</span> <span class="n">newSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 이전 문의 글 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"이전 글 삭제"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(!</span><span class="n">noticeDelete</span><span class="o">(</span><span class="n">sid</span><span class="o">,</span><span class="n">prePassword</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">newSid</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="c1">// file list 저장 및 저장된 파일 수 저장</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">updateFileListAndCnt</span><span class="o">(</span><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">fileSidList</span><span class="o">,</span> <span class="kt">long</span> <span class="n">noticeSid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"update "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" set file_cnt=?,file_sids=? where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">fileSidList</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">fileSidList</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">noticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h2 id="sql-파일-저장">SQL 파일 저장</h2>

<h3 id="table-만들기-1">Table 만들기</h3>
<ul>
  <li>sid</li>
  <li>비 회원 게시글 sid ( 외래키 )</li>
  <li>파일 이름</li>
  <li>파일 바이너리</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">no_member_notice_file</span> <span class="p">(</span>
    <span class="n">sid</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">notice_board_sid</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">file_name</span> <span class="n">NVARCHAR2</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
    <span class="n">file_content</span> <span class="nb">blob</span><span class="p">,</span>
    <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">notice_board_sid</span><span class="p">)</span> <span class="k">references</span> <span class="n">no_member_notice_board</span> <span class="p">(</span><span class="n">sid</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<h3 id="파일-추가하기">파일 추가하기</h3>
<ul>
  <li>바이너리 형태로 DB 테이블에 파일을 저장한다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">insert</span> <span class="k">into</span> <span class="n">no_member_notice_file</span><span class="err"> </span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">notice_board_sid</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_content</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="dao-코드-7">DAO 코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoMemberNoticeBoardFileDAO</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">long</span> <span class="nf">saveNoticeFile</span><span class="o">(</span><span class="kt">long</span> <span class="n">noticeBoardSid</span><span class="o">,</span> <span class="nc">Part</span> <span class="n">part</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">long</span> <span class="n">re</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">sid</span> <span class="o">=</span> <span class="n">genSid</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"insert into "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" (sid, notice_board_sid, file_name, file_content) values(?,?,?,?)"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">sid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">noticeBoardSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">part</span><span class="o">.</span><span class="na">getSubmittedFileName</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setBinaryStream</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="n">part</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">(),</span> <span class="n">part</span><span class="o">.</span><span class="na">getSize</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="n">sid</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="파일-이름-읽어오기">파일 이름 읽어오기</h3>
<ul>
  <li>테이블에 저장된 파일이름을 읽어 온다.</li>
  <li>다운로드 링크를 만들때 사용된다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">file_name</span> <span class="k">from</span> <span class="n">no_member_notice_file</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=?</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="dao-코드-8">DAO 코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getFileName</span><span class="o">(</span><span class="kt">long</span> <span class="n">sid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">"none"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"select file_name from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">sid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">re</span><span class="o">.</span><span class="na">next</span><span class="o">()){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileName</span><span class="o">=</span><span class="s">"none"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="파일-가지고-오기">파일 가지고 오기</h3>
<ul>
  <li>파일 sid를 이용하여 테이블에 저장된 파일을 가지고 온다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">file_content</span> <span class="k">from</span> <span class="n">no_member_notice_file</span><span class="err"> </span><span class="k">where</span> <span class="n">sid</span><span class="o">=?</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="dao-코드-9">DAO 코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 찾기</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="nc">InputStream</span> <span class="nf">getFile</span><span class="o">(</span><span class="kt">long</span> <span class="n">fileSid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">InputStream</span> <span class="n">re</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"select file_content from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">next</span><span class="o">()){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">blob</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getBlob</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="na">getBinaryStream</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="문의글에-속하는-파일-삭제하기">문의글에 속하는 파일 삭제하기</h3>
<ul>
  <li>문의글 sid를 이용하여 문의글에 속하는 파일을 삭제해 준다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">delete</span> <span class="k">from</span> <span class="n">no_member_notice_file</span><span class="err"> </span><span class="k">where</span> <span class="n">notice_board_sid</span><span class="o">=?</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="dao-코드-10">DAO 코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="c1">// 게시글 에 속한 파일 삭제하기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteNoticeFile</span><span class="o">(</span><span class="kt">long</span> <span class="n">noticeSid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"delete from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" where notice_board_sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">noticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="파일-삭제하기">파일 삭제하기</h3>
<ul>
  <li>파일 sid를 이용하여 파일을 삭제한다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">delete</span> <span class="k">from</span> <span class="n">no_member_notice_file</span><span class="err"> </span><span class="k">where</span> <span class="n">sid</span><span class="o">=?</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="dao-코드-11">DAO 코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 sid 로 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">deleteFile</span><span class="o">(</span><span class="kt">long</span> <span class="n">fileSid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"delete from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="문의글-번호-변경">문의글 번호 변경</h3>
<ul>
  <li>문의글을 수정할 때 새로 만들어진 문의글 sid로 변경한다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">update</span> <span class="n">no_member_notice_file</span> <span class="k">set</span> <span class="n">notice_board_sid</span><span class="o">=?</span> <span class="k">where</span> <span class="n">notice_board_sid</span><span class="o">=?</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="dao-코드-12">DAO 코드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="c1">// 새로운 문의글 sid 로 변경</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">changeNoticeSid</span><span class="o">(</span><span class="kt">long</span> <span class="n">oldSid</span><span class="o">,</span> <span class="kt">long</span> <span class="n">newSid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"update "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" set notice_board_sid=? where notice_board_sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">newSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">oldSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h2 id="첫-페이지-만들기">첫 페이지 만들기</h2>
<ul>
  <li>로그인 페이지와 문의 게시판 페이지를 구분하기 위한 첫 페이지를 만들어 주었다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/11825277-1c2c-47cc-9ed7-4686689e2056" alt="Pasted image 20230622124123" /></li>
  <li>이 페이지는 로그인을 하지 않아도 방문할 수 있다. 즉 회원과 비회원 모두 이용할 수 있다.</li>
</ul>

<h3 id="jsp-코드--first_pagejsp-">JSP 코드 ( first_page.jsp )</h3>
<ul>
  <li>servlet 로 부터 문의 게시판 링크와 로그인 링크를 받아온다.</li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">contentType=</span><span class="s">"text/html;charset=UTF-8"</span><span class="na"> language=</span><span class="s">"java"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;style&gt;</span>
<span class="nt">h1</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">font-size</span><span class="p">:</span> <span class="m">100px</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">margin</span><span class="p">:</span><span class="m">0px</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">padding-bottom</span><span class="p">:</span> <span class="m">100px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.button-design</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">text-decoration</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">border-radius</span><span class="p">:</span> <span class="m">10px</span> <span class="p">/</span> <span class="m">10px</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">width</span><span class="p">:</span> <span class="m">240px</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">font-size</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">margin-right</span><span class="p">:</span> <span class="m">25px</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">margin-left</span><span class="p">:</span> <span class="m">25px</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.button-design</span><span class="nd">:link</span><span class="o">,</span> <span class="nc">.button-design</span><span class="nd">:visited</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">background-color</span><span class="p">:</span> <span class="m">#d0d0d0</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">color</span><span class="p">:</span> <span class="m">#000000</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">padding</span><span class="p">:</span> <span class="m">5px</span> <span class="m">25px</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">display</span><span class="p">:</span> <span class="n">inline-block</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">text-decoration</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.button-design</span><span class="nd">:hover</span><span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">background-color</span><span class="p">:</span> <span class="m">#909090</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body</span> <span class="na">style=</span><span class="s">"display: flex;"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"width: 70%;margin:auto;"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;&lt;b&gt;</span>Happy Hacking<span class="nt">&lt;/b&gt;&lt;/h1&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"width:100%;text-align: center;margin-top: 50px;"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"button-design"</span> <span class="na">href=</span><span class="s">"${noMemberNoticeBoard}"</span><span class="nt">&gt;</span>문의 게시판<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"button-design"</span> <span class="na">href=</span><span class="s">"${signInPage}"</span><span class="nt">&gt;</span>로그인<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h3 id="servlet-코드--mainpagejava-">Servlet 코드 ( MainPage.java )</h3>
<ul>
  <li>로그인 페이지 링크와 문의 게시글 링크를 만들어 보내준다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainPage</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span><span class="o">{</span>
<span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">noMemberSearch</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"/"</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"signInPage"</span><span class="o">,</span> <span class="s">"sign_in_page"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noMemberNoticeBoard"</span><span class="o">,</span> <span class="n">noMemberNoticeBoard</span><span class="o">+</span><span class="s">"?page=1"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">gotoForwardPage</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="s">"/WEB-INF/no_login/first_page.jsp"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h2 id="문의-게시판-페이지">문의 게시판 페이지</h2>
<ul>
  <li>문의 게시판은 비회원, 회원 누구나 이용이 가능하다.</li>
  <li>문의 게시글을 저장을 할려면 비밀번호 입력은 필수이다.</li>
  <li>문의 게시글의 제목은 누구나 볼 수 있지만 본문 내용은 문의 글 작성자 또는 관리자만이 볼 수 있다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/61c1bc2c-1d9a-4dc7-b33f-e822082bef6f" alt="Pasted image 20230622125018" /></li>
  <li>문의 게시판은 전에 만들었던 사용자 게시판 기능 코드와 거의 유사하다.</li>
  <li>게시글을 클릭하면 비밀번호 입력창이 뜬다. 여기서 비밀번호를 맞게 입력해야 문의 게시글 확인이 가능하다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/e744b63d-4b36-4250-b683-df60abbd43a4" alt="Pasted image 20230622125256" /></li>
</ul>

<h3 id="jsp-코드--notice_boardjsp-">JSP 코드 ( notice_board.jsp )</h3>
<ul>
  <li>전에 만들었던 게시판 코드와 거의 유사하다는 것을 확인할 수 있다.</li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">contentType=</span><span class="s">"text/html;charset=UTF-8"</span><span class="na"> language=</span><span class="s">"java"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;%@ page </span><span class="na">import=</span><span class="s">"java.util.ArrayList"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%@ page </span><span class="na">import=</span><span class="s">"com.mingyu2.happyhackingmain.noMemberNoticeBoard.NoMemberNoticeBoard"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%</span>
<span class="kt">var</span> <span class="n">arr</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">NoMemberNoticeBoard</span><span class="err">&gt;</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"noticeBoard"</span><span class="o">);</span>
<span class="k">if</span><span class="o">(</span><span class="n">arr</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">arr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">NoMemberNoticeBoard</span><span class="err">&gt;</span><span class="o">();</span>
<span class="o">}</span>

<span class="kt">var</span> <span class="n">pagination</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="err">&gt;</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"pagination"</span><span class="o">);</span>
<span class="kt">var</span> <span class="n">currentPage</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Integer</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"currentPage"</span><span class="o">);</span>
<span class="kt">var</span> <span class="n">lastPage</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Integer</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"lastPage"</span><span class="o">);</span>
<span class="nt">%&gt;</span>

<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;style&gt;</span>
<span class="nc">.button-design</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">text-decoration</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">border-radius</span><span class="p">:</span> <span class="m">10px</span> <span class="p">/</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.button-design</span><span class="nd">:link</span><span class="o">,</span> <span class="nc">.button-design</span><span class="nd">:visited</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">background-color</span><span class="p">:</span> <span class="m">#d0d0d0</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">color</span><span class="p">:</span> <span class="m">#000000</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">padding</span><span class="p">:</span> <span class="m">5px</span> <span class="m">25px</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">display</span><span class="p">:</span> <span class="n">inline-block</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">text-decoration</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.button-design</span><span class="nd">:hover</span><span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">background-color</span><span class="p">:</span> <span class="m">#909090</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.notice-board-list</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#000000</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">padding</span><span class="p">:</span> <span class="m">16px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.notice-board-list</span><span class="nd">:hover</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">background</span><span class="p">:</span> <span class="m">#e0e0e0</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.pagination-item</span><span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">text-decoration</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">border</span> <span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#d0d0d0</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">border-radius</span><span class="p">:</span> <span class="m">10px</span> <span class="p">/</span> <span class="m">10px</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="m">1px</span> <span class="m">0</span> <span class="m">1px</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span> <span class="m">10px</span> <span class="m">0</span> <span class="m">10px</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">color</span> <span class="p">:</span> <span class="m">#000000</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err">&amp;[aria-selected="true"]</span> <span class="err">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nl">background-color</span><span class="p">:</span> <span class="m">#6699FF</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span><span class="o">;</span>
<span class="err">}</span>
<span class="nc">.pagination-item</span><span class="nd">:hover</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err">&amp;[aria-selected="false"]</span> <span class="err">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nl">background-color</span><span class="p">:</span> <span class="m">#e0e0e0</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span><span class="o">;</span>
<span class="err">}</span>
<span class="nc">.modal</span><span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">display</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">position</span><span class="p">:</span> <span class="nb">fixed</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">z-index</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">right</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">overflow</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">background-color</span><span class="p">:</span> <span class="nb">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">background-color</span><span class="p">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span> <span class="m">0.4</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="c">/* padding-top: 60px; */</span>
<span class="p">}</span>
<span class="nc">.modal-content</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">background-color</span><span class="p">:</span> <span class="m">#fefefe</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">margin</span><span class="p">:</span> <span class="m">30%</span> <span class="nb">auto</span> <span class="m">15%</span> <span class="nb">auto</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">border</span><span class="p">:</span> <span class="m">3px</span> <span class="nb">solid</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">width</span><span class="p">:</span> <span class="m">40%</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nf">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">==</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">addr</span><span class="dl">'</span><span class="p">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">addr</span><span class="dl">'</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nf">noticeDetail</span><span class="p">(</span><span class="nx">sid</span><span class="p">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">addr</span><span class="dl">'</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="o">=</span><span class="dl">'</span><span class="s1">block</span><span class="dl">'</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">sid</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">sid</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"addr"</span> <span class="na">class=</span><span class="s">"modal"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-content"</span><span class="nt">&gt;</span>
<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"${noMemberNoitceDetail}"</span> <span class="na">style=</span><span class="s">"margin-top:10px;margin-bottom: 10px;font-size: 20px;"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;&lt;b&gt;</span>문의글 비밀번호<span class="nt">&lt;/b&gt;&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"sid"</span> <span class="na">style=</span><span class="s">"display: none;"</span> <span class="na">name=</span><span class="s">"detailsid"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">style=</span><span class="s">"font-size: 20px;width: 90%;margin:auto;margin-top: 10px;margin-bottom: 10px;"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"전송"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"text-align:right;"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"button-design"</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>뒤로가기<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;h1</span> <span class="na">style=</span><span class="s">"width: 100%; text-align:center;"</span><span class="nt">&gt;</span>문의 게시판<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;hr&gt;</span>
<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"text-align:right;"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"button-design"</span> <span class="na">href=</span><span class="s">"${noMemberNoticeWrite}"</span><span class="nt">&gt;</span>문의 글쓰기<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"width: 70%;margin:auto;margin-top:10px"</span><span class="nt">&gt;</span>
<span class="nt">&lt;%</span> <span class="k">for</span><span class="o">(</span><span class="kt">var</span> <span class="n">n</span> <span class="o">:</span> <span class="n">arr</span><span class="o">)</span> <span class="o">{</span>  <span class="nt">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"notice-board-list"</span> <span class="na">onclick=</span><span class="s">"noticeDetail(</span><span class="nt">&lt;%=</span><span class="n">n</span><span class="o">.</span><span class="na">getSid</span><span class="o">()</span> <span class="nt">%&gt;</span><span class="s">);"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2</span> <span class="na">style=</span><span class="s">"margin:5px 0"</span><span class="nt">&gt;&lt;%=</span><span class="n">n</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()</span> <span class="nt">%&gt;&lt;/h2&gt;</span>
    <span class="nt">&lt;span&gt;</span>비밀글 입니다.<span class="nt">&lt;/span&gt;&lt;br&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;%</span> <span class="o">}</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pagination"</span> <span class="na">style=</span><span class="s">"text-align: center;margin-bottom: 30px;"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;%</span> <span class="k">if</span><span class="o">(</span><span class="n">currentPage</span> <span class="o">!=</span> <span class="mi">1</span><span class="o">){</span> <span class="nt">%&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"pagination-item"</span> <span class="na">href=</span><span class="s">"${noMemberNoticeBoard}?page=</span><span class="nt">&lt;%=</span><span class="o">(</span><span class="n">currentPage</span><span class="o">-</span><span class="mi">1</span><span class="o">)</span><span class="nt">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>Prev<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;%</span> <span class="o">}</span> <span class="nt">%&gt;</span>
    <span class="nt">&lt;%</span> <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="nl">n:</span><span class="n">pagination</span><span class="o">)</span> <span class="o">{</span> <span class="nt">%&gt;</span>
        <span class="nt">&lt;%</span> <span class="k">if</span><span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="err">"</span><span class="o">&lt;</span><span class="n">a</span><span class="err">&gt;</span><span class="o">...&lt;/</span><span class="n">a</span><span class="err">&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">continue</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="nt">%&gt;</span>
        <span class="nt">&lt;%</span> <span class="k">if</span><span class="o">(</span><span class="n">n</span> <span class="o">!=</span> <span class="n">currentPage</span><span class="o">)</span> <span class="o">{</span> <span class="nt">%&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"pagination-item"</span> <span class="na">aria-selected=</span><span class="s">"false"</span> <span class="na">href=</span><span class="s">"${noMemberNoticeBoard}?page=</span><span class="nt">&lt;%=</span><span class="n">n</span><span class="nt">%&gt;</span><span class="s">"</span><span class="nt">&gt;&lt;%=</span><span class="n">n</span><span class="nt">%&gt;&lt;/a&gt;</span>
        <span class="nt">&lt;%</span> <span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="nt">%&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"pagination-item"</span> <span class="na">aria-selected=</span><span class="s">"true"</span><span class="nt">&gt;&lt;%=</span><span class="n">n</span><span class="nt">%&gt;&lt;/a&gt;</span>
        <span class="nt">&lt;%</span> <span class="o">}</span> <span class="nt">%&gt;</span>
    <span class="nt">&lt;%</span> <span class="o">}</span> <span class="nt">%&gt;</span>
    <span class="nt">&lt;%</span> <span class="k">if</span><span class="o">(</span><span class="n">currentPage</span> <span class="o">!=</span> <span class="n">lastPage</span><span class="o">){</span> <span class="nt">%&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"pagination-item"</span> <span class="na">href=</span><span class="s">"${noMemberNoticeBoard}?page=</span><span class="nt">&lt;%=</span><span class="o">(</span><span class="n">currentPage</span><span class="o">+</span><span class="mi">1</span><span class="o">)</span><span class="nt">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>Next<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;%</span> <span class="o">}</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h3 id="servlet-코드--mainpagejava--1">Servlet 코드 ( MainPage.java )</h3>
<ul>
  <li>문의 게시글을 리스트로 만들어 JSP에 전달한다. 그리고 페이징을 시스템이 적용되어 한번에 5개의 게시글을 확인할 수 있다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainPage</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span><span class="o">{</span>
<span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">noMemberSearch</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 문의 게시판 목록</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noMemberNoticeBoard</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">p</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"page"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">page</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">page</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noMemNoticeBoardDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">noMemNoticeBoardDAO</span><span class="o">.</span><span class="na">getCount</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">cnt</span> <span class="o">==</span> <span class="mi">0</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// ****** 클라이언트가 수정 가능 *******</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 한 페이지 보여줄 데이터 갯수 정하기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// ****** 클라이언트가 수정 가능 *******</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 마지막 페이지</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">int</span> <span class="n">lastPage</span> <span class="o">=</span> <span class="o">(</span><span class="n">cnt</span><span class="o">/</span><span class="n">number</span><span class="o">)+((</span><span class="n">cnt</span><span class="o">%</span><span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)?</span><span class="mi">0</span><span class="o">:</span><span class="mi">1</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 최대 페이지 수를 초과하면 가장 마지막 페이지로 이동한다.</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">page</span> <span class="o">&gt;</span> <span class="n">lastPage</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">noMemberNoticeWrite</span><span class="o">+</span><span class="s">"?page="</span><span class="o">+</span><span class="n">lastPage</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 데이터 시작 위치</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">int</span> <span class="n">start</span> <span class="o">=</span> <span class="o">(</span><span class="n">page</span><span class="o">-</span><span class="mi">1</span><span class="o">)*</span><span class="n">number</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 검색 데이터 가져오기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">array</span> <span class="o">=</span> <span class="n">noMemNoticeBoardDAO</span><span class="o">.</span><span class="na">getNoticeList</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">number</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">//***** 페이징 정보 *****</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pagination</span><span class="o">=</span><span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// ****** 클라이언트가 수정 가능 *******</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">paginationBase</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span> <span class="c1">// 기본이되는 페이징 홀수</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// ****** 클라이언트가 수정 가능 *******</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pagination</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">page</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 페이징을 배열에 저장한다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">leftEnd</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">rightEnd</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">left</span><span class="o">=</span><span class="n">page</span><span class="o">,</span> <span class="n">right</span><span class="o">=</span><span class="n">page</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">paginationBase</span><span class="o">-</span><span class="mi">1</span><span class="o">;){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// left</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">left</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">left</span> <span class="o">-=</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pagination</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">left</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">i</span><span class="o">++;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">leftEnd</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// right</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">right</span> <span class="o">&lt;</span> <span class="n">lastPage</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">right</span><span class="o">+=</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pagination</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">right</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">i</span><span class="o">++;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">rightEnd</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">leftEnd</span> <span class="o">&amp;&amp;</span> <span class="n">rightEnd</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">break</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 첫번째 페이지와 마지막 페이지를 포함해야 하는지 검사한다. 포함해야 하면 포함시킨다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 0 은 생략을 의미한다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// prev 1 ... 3 4 5 6 next</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">f</span> <span class="o">=</span> <span class="n">pagination</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">f</span> <span class="o">!=</span> <span class="mi">1</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">f</span> <span class="o">!=</span> <span class="mi">2</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pagination</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pagination</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">l</span> <span class="o">=</span> <span class="n">pagination</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">pagination</span><span class="o">.</span><span class="na">size</span><span class="o">()-</span><span class="mi">1</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">l</span> <span class="o">!=</span> <span class="n">lastPage</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">l</span> <span class="o">!=</span> <span class="n">lastPage</span><span class="o">-</span><span class="mi">1</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pagination</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pagination</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">lastPage</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">//***** 페이징 정보 end *****</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">//***** 정보 넘겨주기 *****</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noticeBoard"</span><span class="o">,</span> <span class="n">array</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 페이징 번호 리스트</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"pagination"</span><span class="o">,</span> <span class="n">pagination</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 현재 페이지 정보 page</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"currentPage"</span><span class="o">,</span> <span class="n">page</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 마지막 Page</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"lastPage"</span><span class="o">,</span> <span class="n">lastPage</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noMemberNoitceDetail"</span><span class="o">,</span> <span class="n">noMemberNoitceDetail</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noMemberNoticeWrite"</span><span class="o">,</span><span class="n">noMemberNoticeWrite</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noMemberNoticeBoard"</span><span class="o">,</span><span class="n">noMemberNoticeBoard</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">gotoForwardPage</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="s">"/WEB-INF/no_login/notice_board/notice_board.jsp"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 문의 게시판 목록 end</span>
</code></pre></div></div>

<h2 id="문의-게시글-새로-작성하기-페이지">문의 게시글 새로 작성하기 페이지</h2>
<ul>
  <li>기존의 게시글 작성 폼을 이용하였다.</li>
  <li>문의 게시글을 저장하기 위해서는 빈칸이 없어야 한다. 그리고 비밀번호 입력은 필수이다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/856ca911-e3f8-4e90-a291-6e9116da7a0a" alt="Pasted image 20230622130426" /><br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/6f815719-95e7-4a73-84a0-93f41c0ad95a" alt="Pasted image 20230622130438" /></li>
</ul>

<h3 id="jsp-코드--notice_writejsp-">JSP 코드 ( notice_write.jsp )</h3>
<ul>
  <li>게시글 작성 코드와 동일하다.</li>
  <li>문의 글 작성 모드일 때만 비밀번호 입력창이 나타난다.</li>
  <li>코드가 완전히 동일하고 비밀번호 입력창이 문의 글 작성 때는 나오도록 다음 코드를 추가하였다.</li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%</span> <span class="k">if</span><span class="o">(</span><span class="n">hasPassword</span><span class="o">)</span> <span class="o">{</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>비밀번호<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;td&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">style=</span><span class="s">"width:100%;font-size: 20px;"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">style=</span><span class="s">"display: none;"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"pre-password"</span> <span class="na">value=</span><span class="s">"${prePassword}"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;%</span> <span class="o">}</span> <span class="nt">%&gt;</span>
</code></pre></div></div>

<h3 id="servlet-코드--mainpagejava--2">Servlet 코드 ( MainPage.java )</h3>
<ul>
  <li>비회원 문의 게시글 저장을 위한 링크를 추가해 주었다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 문의 게시판 글 쓰기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noMemberNoticeWrite</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"hasPassword"</span><span class="o">,</span><span class="kc">true</span><span class="o">);</span> <span class="c1">// 비회원 글쓰기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noticeBoardURL"</span><span class="o">,</span> <span class="n">noMemberNoticeSave</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">gotoForwardPage</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="s">"/WEB-INF/main_page/notice_board/notice_write.jsp"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 문의 게시판 글 쓰기 end</span>
</code></pre></div></div>

<h2 id="문의-게시글-저장하기">문의 게시글 저장하기</h2>
<ul>
  <li>문의 게시글 새로작성 페이지에서 저장 버튼을 눌러 저장을 서버에 요청을 하면 빈칸이 있는지와 비밀번호 입력이 되었는지를 확인하여 모두 입력이 되어있다면 문의 게시글 테이블에 게시글을 저장한다.</li>
  <li>첨부된 파일 역시 파일 테이블에 저장해준다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 문의 게시글 저장</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"POST"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noMemberNoticeSave</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">charSet</span> <span class="o">=</span> <span class="s">"utf-8"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="n">charSet</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(!</span><span class="n">request</span><span class="o">.</span><span class="na">getContentType</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">().</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"multipart/form-data"</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">//404 에러 발생</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// application/x-www-form-urlencoded 타입이 아니라.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 오직 multipart/form-data 타입만 받는다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"title"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">mainText</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"main-text"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 실패</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">title</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">))</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('title blink!');window.history.back();&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">mainText</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('main text blink!');window.history.back();&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">password</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('password blink!');window.history.back();&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noMemberNoticeBoardDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeSid</span> <span class="o">=</span> <span class="n">noMemberNoticeBoardDAO</span><span class="o">.</span><span class="na">addNotice</span><span class="o">(</span><span class="n">title</span><span class="o">,</span><span class="n">mainText</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">noticeSid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('save fail!');window.history.back();&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 게시글 저장 성공</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// ***** 파일 업로드 시작 *****</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"no file"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 올바른 파일인지 확인하고 db에 저장한다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParts</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">for</span><span class="o">(</span><span class="kt">var</span> <span class="nl">part:</span><span class="n">parts</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(!</span><span class="n">part</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="s">"filename="</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">continue</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">part</span><span class="o">.</span><span class="na">getSubmittedFileName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">continue</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 이름에 금지된 문자가 사용되면 파일 업로드 안하기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">notCorrectFileName</span><span class="o">(</span><span class="n">part</span><span class="o">.</span><span class="na">getSubmittedFileName</span><span class="o">())){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">continue</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">fileSidList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="no">MAX_FILE_NUM</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file max number"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">break</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 데이터 DB 테이블에 저장하기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardFileDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">()).</span><span class="na">saveNoticeFile</span><span class="o">(</span><span class="n">noticeSid</span><span class="o">,</span> <span class="n">part</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">part</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span> <span class="c1">// 임시파일 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">re</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"업로드 성공"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file upload success"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileSidList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">re</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">else</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"파일 업로드 실패"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file upload fail"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 게시글 file list 와 저장된 파일 갯수 저장하기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noMemberNoticeBoardDAO</span><span class="o">.</span><span class="na">updateFileListAndCnt</span><span class="o">(</span><span class="n">fileSidList</span><span class="o">,</span> <span class="n">noticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"파일 업로드 실패"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file upload fail"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// ***** 파일 업로드 end *****</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('save success! "</span><span class="o">+</span><span class="n">noticeRe</span><span class="o">+</span><span class="s">" ');location.href='"</span><span class="o">+</span><span class="n">noMemberNoticeBoard</span><span class="o">+</span><span class="s">"?page=1"</span><span class="o">+</span><span class="s">"';&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 문의 게시글 저장 end</span>
</code></pre></div></div>

<h2 id="문의-게시글-자세히-보기-페이지">문의 게시글 자세히 보기 페이지</h2>
<ul>
  <li>문의 게시글을 클릭하고 비밀번호를 입력하면 작성한 문의 게시글을 자세히 볼 수 있다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/650fc67f-056c-4df6-b778-384345433047" alt="Pasted image 20230622132306" /></li>
  <li>문의 게시글을 삭제하거나 수정할 수 있다.</li>
</ul>

<h3 id="jsp-코드--notice_detailjsp-">JSP 코드 ( notice_detail.jsp )</h3>
<ul>
  <li>문의 게시글 내용을 확인할 수 있다. 그리고 첨부파일 역시 다운받을 수 있다.</li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">contentType=</span><span class="s">"text/html;charset=UTF-8"</span><span class="na"> language=</span><span class="s">"java"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;%@ page </span><span class="na">import=</span><span class="s">"com.mingyu2.happyhackingmain.noMemberNoticeBoard.NoMemberNoticeBoard"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%@ page </span><span class="na">import=</span><span class="s">"com.mingyu2.happyhackingmain.Pair"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;%@ page </span><span class="na">import=</span><span class="s">"java.util.ArrayList"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;%</span>
<span class="kt">var</span> <span class="n">notice</span> <span class="o">=</span> <span class="o">(</span><span class="nc">NoMemberNoticeBoard</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"notice"</span><span class="o">);</span>
<span class="kt">var</span> <span class="n">fileNameList</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="err">&gt;&gt;</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"fileNameList"</span><span class="o">);</span>
<span class="nt">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;style&gt;</span>
<span class="nc">.main-div</span><span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">margin</span> <span class="p">:</span> <span class="m">0</span> <span class="nb">auto</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">width</span><span class="p">:</span> <span class="m">80%</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.notice_write</span><span class="o">,</span> <span class="nc">.notice_write</span> <span class="nt">th</span><span class="o">,</span> <span class="nc">.notice_write</span> <span class="nt">td</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#bcbcbc</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"main-div"</span><span class="nt">&gt;</span>
<span class="nt">&lt;table</span> <span class="na">style=</span><span class="s">"width: 100%;"</span> <span class="na">class=</span><span class="s">"notice_write"</span><span class="nt">&gt;</span>
<span class="nt">&lt;thead&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span> <span class="na">colspan=</span><span class="s">"2"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h2&gt;&lt;%=</span><span class="n">notice</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()</span> <span class="nt">%&gt;&lt;/h2&gt;</span>
    <span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/thead&gt;</span>
<span class="nt">&lt;tbody&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"text-align: center;"</span> <span class="na">colspan=</span><span class="s">"2"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;%=</span><span class="n">notice</span><span class="o">.</span><span class="na">getGenDate</span><span class="o">()</span> <span class="nt">%&gt;</span>
    <span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;%</span> <span class="k">if</span><span class="o">(</span><span class="n">fileNameList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="err">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"text-align: center;"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span&gt;</span>첨부파일<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>
        <span class="nt">&lt;%</span> <span class="k">for</span><span class="o">(</span><span class="kt">var</span> <span class="n">file</span> <span class="o">:</span> <span class="n">fileNameList</span> <span class="o">)</span> <span class="o">{</span> <span class="nt">%&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${noticeBoardFileDownload}?downlink=</span><span class="nt">&lt;%=</span><span class="n">file</span><span class="o">.</span><span class="na">getD2</span><span class="o">()</span> <span class="nt">%&gt;</span><span class="s">&amp;pageid=</span><span class="nt">&lt;%=</span><span class="n">notice</span><span class="o">.</span><span class="na">getSid</span><span class="o">()</span> <span class="nt">%&gt;</span><span class="s">&amp;password=${password}"</span><span class="nt">&gt;&lt;%=</span><span class="n">file</span><span class="o">.</span><span class="na">getD1</span><span class="o">()</span> <span class="nt">%&gt;&lt;/a&gt;&lt;br&gt;</span>
        <span class="nt">&lt;%</span> <span class="o">}</span> <span class="nt">%&gt;</span>
    <span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;%</span><span class="o">}</span><span class="nt">%&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"2"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"width:100%;word-break:break-all;word-wrap:break-word; overflow-y: auto; height:250px; resize: none;"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;%=</span><span class="n">notice</span><span class="o">.</span><span class="na">getMainText</span><span class="o">()</span> <span class="nt">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"2"</span> <span class="na">style=</span><span class="s">"text-align: right;"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">onclick=</span><span class="s">"javascript:window.history.back();"</span> <span class="na">value=</span><span class="s">"뒤로가기"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">style=</span><span class="s">"margin:0;display: inline-block;"</span> <span class="na">action=</span><span class="s">"${noMemberNoitceDelete}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">style=</span><span class="s">"display: none;"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"pageid"</span> <span class="na">value=</span><span class="s">"</span><span class="nt">&lt;%=</span><span class="n">notice</span><span class="o">.</span><span class="na">getSid</span><span class="o">()</span> <span class="nt">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">style=</span><span class="s">"display: none;"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"${password}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"삭제하기"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">style=</span><span class="s">"margin:0;display: inline-block;"</span> <span class="na">action=</span><span class="s">"${noMemberNoitceModify}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">style=</span><span class="s">"display: none;"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"pageid"</span> <span class="na">value=</span><span class="s">"</span><span class="nt">&lt;%=</span><span class="n">notice</span><span class="o">.</span><span class="na">getSid</span><span class="o">()</span> <span class="nt">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">style=</span><span class="s">"display: none;"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"${password}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"수정하기"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h3 id="servlet-코드--mainpagejava--3">Servlet 코드 ( MainPage.java )</h3>
<ul>
  <li>비회원 문의 게시글을 테이블에서 가지고 온다.</li>
  <li>비밀번호를 맞게 입력해야 문의 게시글을 가지고 온다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 비번 입력 문의 글 읽기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"POST"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noMemberNoitceDetail</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">sid</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"detailsid"</span><span class="o">));</span> <span class="c1">// 문의 게시글 sid</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span> <span class="c1">// 문의 게시글 비밀번호</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 게시글 정보 가지고 오기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noMemberNoticeBoardDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">notice</span> <span class="o">=</span> <span class="n">noMemberNoticeBoardDAO</span><span class="o">.</span><span class="na">getNoitceBoard</span><span class="o">(</span><span class="n">sid</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">notice</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('password diff!');location.href='"</span><span class="o">+</span><span class="n">noMemberNoticeBoard</span><span class="o">+</span><span class="s">"?page=1"</span><span class="o">+</span><span class="s">"';&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeSID</span> <span class="o">=</span> <span class="n">notice</span><span class="o">.</span><span class="na">getSid</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// *** 파일들 읽어 오기 ***</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 이름 찾기 및 href 링크 만들기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileNameList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="n">noMemberNoticeBoardDAO</span><span class="o">.</span><span class="na">getFileSidList</span><span class="o">(</span><span class="n">noticeSID</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeFileDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardFileDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">for</span><span class="o">(</span><span class="kt">var</span> <span class="nl">fileSid:</span><span class="n">fileSidList</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">noticeFileDAO</span><span class="o">.</span><span class="na">getFileName</span><span class="o">(</span><span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileNameList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">fileName</span><span class="o">,</span><span class="n">fileSid</span><span class="o">.</span><span class="na">toString</span><span class="o">()));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"fileNameList"</span><span class="o">,</span> <span class="n">fileNameList</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noticeBoardFileDownload"</span><span class="o">,</span> <span class="n">noMemberNoticeFileDownload</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// *** 파일들 읽어 오기 end ***</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"notice"</span><span class="o">,</span> <span class="n">notice</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"password"</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noMemberNoitceDelete"</span><span class="o">,</span> <span class="n">noMemberNoitceDelete</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noMemberNoitceModify"</span><span class="o">,</span> <span class="n">noMemberNoitceModify</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">gotoForwardPage</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="s">"/WEB-INF/no_login/notice_board/notice_detail.jsp"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('password diff!');location.href='"</span><span class="o">+</span><span class="n">noMemberNoticeBoard</span><span class="o">+</span><span class="s">"?page=1"</span><span class="o">+</span><span class="s">"';&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 비번 입력 문의 글 읽기 end</span>
</code></pre></div></div>

<h2 id="문의-게시글-삭제">문의 게시글 삭제</h2>
<ul>
  <li>문의 게시글에서 삭제 버튼을 누르면 문의 게시글이 삭제된다.</li>
  <li>문의 게시글에 방문할 때 입력한 비밀번호를 이용하여 비밀번호와 게시글 번호가 모두 일치할 때 삭제가 가능하다.</li>
</ul>

<h3 id="servlet-코드--mainpagejava--4">Servlet 코드 ( MainPage.java )</h3>
<ul>
  <li>삭제 버튼을 눌렀을 때 실행되는 코드이다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 글 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"POST"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noMemberNoitceDelete</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">sid</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"pageid"</span><span class="o">));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noMemberNoticeBoardDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(!</span><span class="n">noMemberNoticeBoardDAO</span><span class="o">.</span><span class="na">noticeDelete</span><span class="o">(</span><span class="n">sid</span><span class="o">,</span> <span class="n">password</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('delete fail!');location.href='"</span><span class="o">+</span><span class="n">noMemberNoticeBoard</span><span class="o">+</span><span class="s">"?page=1"</span><span class="o">+</span><span class="s">"';&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('delete fail!');location.href='"</span><span class="o">+</span><span class="n">noMemberNoticeBoard</span><span class="o">+</span><span class="s">"?page=1"</span><span class="o">+</span><span class="s">"';&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('delete success!');location.href='"</span><span class="o">+</span><span class="n">noMemberNoticeBoard</span><span class="o">+</span><span class="s">"?page=1"</span><span class="o">+</span><span class="s">"';&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 글 삭제 end</span>
</code></pre></div></div>

<h2 id="첨부-파일-다운로드">첨부 파일 다운로드</h2>
<ul>
  <li>첨부파일 링크를 눌렀을 때 첨부파일 다운로드가 가능해야 한다.</li>
</ul>

<h3 id="servlet-코드--mainpagejava--5">Servlet 코드 ( MainPage.java )</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 글 첨부파일 다운로드</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noMemberNoticeFileDownload</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">long</span> <span class="n">pageSid</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">long</span> <span class="n">fileSid</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pageSid</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"pageid"</span><span class="o">));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileSid</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"downlink"</span><span class="o">));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">notice</span> <span class="o">=</span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">getNoitceBoard</span><span class="o">(</span><span class="n">pageSid</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">notice</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardFileDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">is</span> <span class="o">=</span> <span class="n">fileDAO</span><span class="o">.</span><span class="na">getFile</span><span class="o">(</span><span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">is</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSize</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">available</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">fileDAO</span><span class="o">.</span><span class="na">getFileName</span><span class="o">(</span><span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 사용자에게 다운로드 보내기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">sMimeType</span> <span class="o">=</span> <span class="n">getServletContext</span><span class="o">().</span><span class="na">getMimeType</span><span class="o">(</span><span class="n">fileName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">sMimeType</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">sMimeType</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">sMimeType</span> <span class="o">=</span> <span class="s">"application/octet-stream"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">BufferedOutputStream</span> <span class="n">outs</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">sMimeType</span><span class="o">+</span><span class="s">"; charset=utf-8"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">fileSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">response</span><span class="o">.</span><span class="na">setContentLength</span><span class="o">(</span><span class="n">fileSize</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">userAgent</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"User-Agent"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">userAgent</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">userAgent</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">userAgent</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"MSIE 5.5"</span><span class="o">)){</span> <span class="c1">// MSIE 5.5 이하</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">userAgent</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">userAgent</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"MSIE"</span><span class="o">)){</span> <span class="c1">// MS IE</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">else</span><span class="o">{</span> <span class="c1">// 모질라</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span> <span class="s">"attachment; filename="</span><span class="o">+</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">fileName</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">"utf-8"</span><span class="o">),</span> <span class="s">"latin1"</span><span class="o">)</span> <span class="o">+</span> <span class="s">";"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
  
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 사용자에게 파일을 전송한다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">outs</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedOutputStream</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">int</span> <span class="n">read</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">8192</span><span class="o">];</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">while</span><span class="o">((</span><span class="n">read</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">b</span><span class="o">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">outs</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">read</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">outs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 다운로드 완료 된후 DB 연결을 해제해야한다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileDAO</span><span class="o">.</span><span class="na">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"사용자 파일 다운로드 "</span><span class="o">+</span> <span class="n">pageSid</span> <span class="o">+</span> <span class="s">"  "</span><span class="o">+</span> <span class="n">fileSize</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 글 첨부파일 다운로드 end</span>
</code></pre></div></div>

<h2 id="문의-글-수정-페이지">문의 글 수정 페이지</h2>
<ul>
  <li>수정하기 버튼을 누르면 수정페이지로 넘어간다.</li>
  <li>게시글 작성 코드를 이용하였다.</li>
  <li>첨부파일을 삭제하거나 추가할 수 있다.</li>
  <li>비밀번호와 게시글 번호가 일치해야 게시글 수정이 가능하다.</li>
</ul>

<h3 id="servlet-코드--mainpagejava--6">Servlet 코드 ( MainPage.java )</h3>
<ul>
  <li>수정할 때 필요한 정보를 jsp에 넘겨준다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 글 수정 페이지</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"POST"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noMemberNoitceModify</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">sid</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"pageid"</span><span class="o">));</span> <span class="c1">// 문의 게시글 sid</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span> <span class="c1">// 문의 게시글 비밀번호</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 게시글 정보 가지고 오기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noMemberNoticeBoardDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">notice</span> <span class="o">=</span> <span class="n">noMemberNoticeBoardDAO</span><span class="o">.</span><span class="na">getNoitceBoard</span><span class="o">(</span><span class="n">sid</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">notice</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('password diff!');location.href='"</span><span class="o">+</span><span class="n">noMemberNoticeBoard</span><span class="o">+</span><span class="s">"?page=1"</span><span class="o">+</span><span class="s">"';&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// *** 파일들 읽어 오기 ***</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 이름 찾기 및 href 링크 만들기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeSID</span> <span class="o">=</span> <span class="n">notice</span><span class="o">.</span><span class="na">getSid</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileNameList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="n">noMemberNoticeBoardDAO</span><span class="o">.</span><span class="na">getFileSidList</span><span class="o">(</span><span class="n">noticeSID</span><span class="o">);</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeFileDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardFileDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">for</span><span class="o">(</span><span class="kt">var</span> <span class="nl">fileSid:</span><span class="n">fileSidList</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">noticeFileDAO</span><span class="o">.</span><span class="na">getFileName</span><span class="o">(</span><span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileNameList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">fileName</span><span class="o">,</span><span class="n">fileSid</span><span class="o">.</span><span class="na">toString</span><span class="o">()));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"fileNameList"</span><span class="o">,</span> <span class="n">fileNameList</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noticeBoardFileDownload"</span><span class="o">,</span> <span class="n">noMemberNoticeFileDownload</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noticeBoardFileDelete"</span><span class="o">,</span> <span class="n">noticeBoardFileDelete</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// *** 파일들 읽어 오기 end ***</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"notice"</span><span class="o">,</span> <span class="n">notice</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noticeID"</span><span class="o">,</span> <span class="n">notice</span><span class="o">.</span><span class="na">getSid</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"prePassword"</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="n">notice</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"mainText"</span><span class="o">,</span> <span class="n">notice</span><span class="o">.</span><span class="na">getMainText</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"fileNameList"</span><span class="o">,</span> <span class="n">fileNameList</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noticeBoardURL"</span><span class="o">,</span> <span class="n">noMemberNoitceModifySave</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"hasPassword"</span><span class="o">,</span><span class="kc">true</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"modifyMode"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">gotoForwardPage</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="s">"/WEB-INF/main_page/notice_board/notice_write.jsp"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 글 수정 페이지 end</span>
</code></pre></div></div>

<h2 id="수정된-문의-글-저장하기">수정된 문의 글 저장하기</h2>
<ul>
  <li>문의 글 수정을 완료한 후 저장하기 버튼을 누르면 문의 글 수정이 반영된다. 여기서 새로운 비밀번호 입력은 필수이다.</li>
</ul>

<h3 id="servlet-코드--mainpagejava--7">Servlet 코드 ( MainPage.java )</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 글 수정 저장하기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"POST"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noMemberNoitceModifySave</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"title"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">mainText</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"main-text"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">sid</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"noticeID"</span><span class="o">));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">prePassword</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"pre-password"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 실패</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">title</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">))</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('title blink!');window.history.back();&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">mainText</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('main text blink!');window.history.back();&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">password</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('password blink!');window.history.back();&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 이전 비밀 번호 검사</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noMemberNoticeBoardDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">newNoticeId</span> <span class="o">=</span> <span class="n">noMemberNoticeBoardDAO</span><span class="o">.</span><span class="na">noticeModifySave</span><span class="o">(</span><span class="n">sid</span><span class="o">,</span><span class="n">prePassword</span><span class="o">,</span><span class="n">title</span><span class="o">,</span><span class="n">mainText</span><span class="o">,</span><span class="n">password</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">newNoticeId</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('modify fail!');window.history.back();&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// ***** 파일 업로드 시작 *****</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"no file"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 올바른 파일인지 확인하고 db에 저장한다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParts</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="n">noMemberNoticeBoardDAO</span><span class="o">.</span><span class="na">getFileSidList</span><span class="o">(</span><span class="n">newNoticeId</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">for</span><span class="o">(</span><span class="kt">var</span> <span class="nl">part:</span><span class="n">parts</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(!</span><span class="n">part</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="s">"filename="</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">continue</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">part</span><span class="o">.</span><span class="na">getSubmittedFileName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">continue</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 이름에 금지된 문자가 사용되면 파일 업로드 안하기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">notCorrectFileName</span><span class="o">(</span><span class="n">part</span><span class="o">.</span><span class="na">getSubmittedFileName</span><span class="o">())){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">continue</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">fileSidList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="no">MAX_FILE_NUM</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file max number"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">break</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 데이터 DB 테이블에 저장하기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardFileDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">()).</span><span class="na">saveNoticeFile</span><span class="o">(</span><span class="n">newNoticeId</span><span class="o">,</span> <span class="n">part</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">part</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span> <span class="c1">// 임시파일 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">re</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"업로드 성공"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file upload success"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileSidList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">re</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">else</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"파일 업로드 실패"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file upload fail"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 게시글 file list 와 저장된 파일 갯수 저장하기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noMemberNoticeBoardDAO</span><span class="o">.</span><span class="na">updateFileListAndCnt</span><span class="o">(</span><span class="n">fileSidList</span><span class="o">,</span> <span class="n">newNoticeId</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"파일 업로드 실패"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file upload fail"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// ***** 파일 업로드 end *****</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"&lt;script&gt;alert('modify success!"</span><span class="o">+</span><span class="n">noticeRe</span><span class="o">+</span><span class="s">"');location.href='"</span><span class="o">+</span><span class="n">noMemberNoticeBoard</span><span class="o">+</span><span class="s">"?page=1"</span><span class="o">+</span><span class="s">"';&lt;/script&gt;"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비회원 글 수정 저장하기 end</span>
</code></pre></div></div>

<h2 id="첨부파일-삭제하기">첨부파일 삭제하기</h2>
<ul>
  <li>문의글 수정 페이지에서 특정 첨부파일을 하나씩 삭제할 수 있다.</li>
</ul>

<h3 id="servlet-코드--mainpagejava--8">Servlet 코드 ( MainPage.java )</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"GET"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noticeBoardFileDelete</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="s">"fail"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeSid</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"noticeID"</span><span class="o">));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSid</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"filename"</span><span class="o">));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">notice</span> <span class="o">=</span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">getNoitceBoard</span><span class="o">(</span><span class="n">noticeSid</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">notice</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span> <span class="c1">// 비번 틀려서 다운 못받음</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"{\"result\":\"fail\"}"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoMemberNoticeBoardFileDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(!</span><span class="n">fileDAO</span><span class="o">.</span><span class="na">deleteFile</span><span class="o">(</span><span class="n">fileSid</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"{\"result\":\"fail\"}"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="s">"success"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">getFileSidList</span><span class="o">(</span><span class="n">noticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileSidList</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">updateFileListAndCnt</span><span class="o">(</span><span class="n">fileSidList</span><span class="o">,</span> <span class="n">noticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"삭제 완료!"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="s">"fail"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"{\"result\":\""</span><span class="o">+</span><span class="n">re</span><span class="o">+</span><span class="s">"\"}"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 삭제 end</span>
</code></pre></div></div>]]></content><author><name>Jung MinGyu</name></author><category term="servlet" /><category term="jsp" /><category term="db" /><category term="게시판" /><summary type="html"><![CDATA[비회원 문의 게시판을 만들어 보자.]]></summary></entry><entry><title type="html">웹 서버 용어 및 취약점 간단한 정리</title><link href="http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84%EC%9A%A9%EC%96%B4%EA%B0%84%EB%8B%A8%ED%95%9C%EC%A0%95%EB%A6%AC/" rel="alternate" type="text/html" title="웹 서버 용어 및 취약점 간단한 정리" /><published>2023-06-16T00:00:00+09:00</published><updated>2023-06-16T23:13:00+09:00</updated><id>http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84%EC%9A%A9%EC%96%B4%EA%B0%84%EB%8B%A8%ED%95%9C%EC%A0%95%EB%A6%AC</id><content type="html" xml:base="http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84%EC%9A%A9%EC%96%B4%EA%B0%84%EB%8B%A8%ED%95%9C%EC%A0%95%EB%A6%AC/"><![CDATA[<h2 id="인증">인증</h2>
<ul>
  <li>그 사람이 맞는지 확인하는 작업이다.</li>
</ul>

<h2 id="인가">인가</h2>
<ul>
  <li>허락된 사람에게만 어떤 권한을 부여하는 것이다.</li>
</ul>

<h2 id="쿠키">쿠키</h2>
<ul>
  <li>클라이언트 측에 저장되는 작은 기록 정보 파일이다.</li>
  <li>웹 서버로 보내는 작은 데이터 조각이다.</li>
</ul>

<h2 id="세션">세션</h2>
<ul>
  <li>유저의 정보를 서버에 저장한다.</li>
  <li>서버에 유저의 인증정보를 저장한다.</li>
  <li>클라이언트의 인증 상태정보를 저장한다.</li>
  <li>연결 지속성을 제공하기위해 서버에 저장되는 정보이다.</li>
</ul>

<h2 id="세션-id">세션 ID</h2>
<ul>
  <li>세션 테이블을 구분하기 위한 ID 이다.</li>
  <li>세션을 식별하기 위하여 사용되는 작은 데이터 이다.</li>
</ul>

<h2 id="인증-취약점">인증 취약점</h2>

<h3 id="인증-우회">인증 우회</h3>
<ul>
  <li>인증 기능을 서버에 구현해야 하지만 클라이언트 측에서 인증 검사가 구현되었을 때 발생하는 취약점이다.</li>
  <li>인증을 해야 접속할 수 있는 코드가 주석 처리되어 코드에 남아있을 경우 인증 우회가 발생한다.</li>
</ul>

<h3 id="대응방안">대응방안</h3>
<ul>
  <li>서버에서 인증 기능이 구현되어야 한다. 즉 서버에서 인증 검사를 하여야 한다.</li>
  <li>인증을 우회할 수 있는 민감한 정보가 클라이언트 측 스크립트에  남아 있으면 삭제하여야 한다.</li>
</ul>

<h2 id="인가-취약점">인가 취약점</h2>

<h3 id="인가-우회">인가 우회</h3>
<ul>
  <li>서버에서 불충분한 검사에 의하여 발생한다.</li>
  <li>권한이 없는데 해당 정보를 확인하거나 수정 또는 삭제를 할 수 있다.</li>
  <li>파라미터 값 또는 쿠키 값을 통해 사용자를 구분한다면 사용자는 값 변조를 통해 열람 권한이 없는 다른 유저의 정보를 확인할 수 있다.</li>
</ul>

<h3 id="대응방안-1">대응방안</h3>
<ul>
  <li>서버에서 세션을 통하여 권한이 있는 유저인지 판단하여야 한다.</li>
  <li>민감한 정보를 접근할 때 서버에서 세션 ID 또는 발급받은 토큰을 이용하여 권한이 있는지 검사하여야한다.</li>
</ul>

<h2 id="우회-팁">우회 팁</h2>

<h3 id="자바스크립트-난독화-되어-있을-때">자바스크립트 난독화 되어 있을 때</h3>

<h4 id="정적-분석하기">정적 분석하기</h4>
<ul>
  <li>자바스크립트 난독화 해제 기능을 이용하여 난독화 해제하기.</li>
</ul>

<h4 id="동적-분석하기">동적 분석하기</h4>
<ul>
  <li>true 가 되는 조건을 찾아 직접 실행시키기. 즉 인증이 되는 조건을 스크립트를 분석하여 찾아 실행시켜주면 된다.</li>
</ul>

<h3 id="hsts-오류">HSTS 오류</h3>
<ul>
  <li>강제로 HTTPS 연결을 하게 만드는 옵션이다.</li>
  <li>동적 HSTS 정책에 저장된 도메인을 삭제해 주면 된다.</li>
</ul>

<h4 id="edge-브라우저-일-경우">edge 브라우저 일 경우</h4>
<ol>
  <li><code class="language-plaintext highlighter-rouge">edge://net-internals/#hsts</code> 에 접속한다.</li>
  <li>삭제할 도메인 명을 입력해 준다.</li>
</ol>

<p><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/57e24d92-732b-40de-b925-f6ff561578b5" alt="Pasted image 20230616215502" /></p>

<h4 id="chrome-브라우저-일-경우">chrome 브라우저 일 경우</h4>
<ol>
  <li><code class="language-plaintext highlighter-rouge">chrome://net-internals/#hsts</code> 에 접속한다.</li>
  <li>삭제할 도메인 명을 입력해 준다.</li>
</ol>

<p><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/85517351-15af-4eea-944f-9ace54907c23" alt="Pasted image 20230616215739" /></p>]]></content><author><name>Jung MinGyu</name></author><category term="인증" /><category term="인가" /><category term="쿠키" /><category term="세션" /><category term="세션ID" /><category term="javascript" /><category term="HSTS" /><summary type="html"><![CDATA[웹 서버 용어 및 취약점에 대하여 간단히 정리해 보자.]]></summary></entry><entry><title type="html">보고서 작성법</title><link href="http://localhost:4000/%EB%B3%B4%EA%B3%A0%EC%84%9C%EC%9E%91%EC%84%B1%EB%B2%95/" rel="alternate" type="text/html" title="보고서 작성법" /><published>2023-06-12T00:00:00+09:00</published><updated>2023-06-12T23:13:00+09:00</updated><id>http://localhost:4000/%EB%B3%B4%EA%B3%A0%EC%84%9C%EC%9E%91%EC%84%B1%EB%B2%95</id><content type="html" xml:base="http://localhost:4000/%EB%B3%B4%EA%B3%A0%EC%84%9C%EC%9E%91%EC%84%B1%EB%B2%95/"><![CDATA[<h2 id="보고서">보고서</h2>
<ul>
  <li>내용을 깔끔하게 전달하기 위한 것이다.</li>
  <li>최종 결과물이다.</li>
</ul>

<h2 id="구성">구성</h2>
<ul>
  <li>표지 + 이름</li>
  <li>목차</li>
  <li>본문</li>
</ul>

<h2 id="작성법">작성법</h2>

<h3 id="폰트-통일하기">폰트 통일하기</h3>
<ul>
  <li>스타일, 크기, 색깔을 통일하자. 하지만 제목 부분이나 본문 부분의 글자 크기는 약간 차이가 날 수 있다.</li>
  <li>보고서에는 글씨 색을 많이 안 넣는 것이 좋다. 너무 쓰고 싶다면 굵은 글씨( bold ) 를 사용하자. 글이 완전히 달라야 하면 빨간색 글씨를 써주자.</li>
</ul>

<h3 id="사진">사진</h3>
<ul>
  <li>표랑 그림의 너비를 동일하게 일치시키기.</li>
  <li>높이는 굳이 똑같이 맞출 필요는 없다.</li>
  <li>그림 크기를 수정할 때는 대각선을 클릭하여 수정하자. ( 또는 그림 서식에서 너비 값을 입력하여 조정하기. )</li>
  <li>본문의 글씨와 사진의 글씨 크기가 어느정도 비슷해야한다. ( 깔끔하게 보임. )</li>
  <li>사진 테두리 넣어주기.</li>
  <li>그림 캡션 ( 그림 제목 ) 추가하기.</li>
</ul>

<h3 id="풀이-과정-디테일하게-정리">풀이 과정 디테일하게 정리</h3>
<ul>
  <li>어떤한 시도를 하면 서버에서 어떻게 처리되었길래 이러한 결과가 나왔는지 정리하기. ( 자세히 정리하기 )</li>
</ul>

<h3 id="코드-넣기">코드 넣기</h3>
<ul>
  <li>코드를 캡쳐해서 넣기.</li>
  <li>표를 만들어 표에 코드를 넣기.</li>
</ul>]]></content><author><name>Jung MinGyu</name></author><category term="보고서" /><summary type="html"><![CDATA[보고서를 어떻게 작성해야 하는지 정리해보자.]]></summary></entry><entry><title type="html">웹 서버 개발 (18) DB 테이블에 파일 저장하기</title><link href="http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C18DB%ED%85%8C%EC%9D%B4%EB%B8%94%ED%8C%8C%EC%9D%BC%EC%A0%80%EC%9E%A5/" rel="alternate" type="text/html" title="웹 서버 개발 (18) DB 테이블에 파일 저장하기" /><published>2023-06-11T00:00:00+09:00</published><updated>2023-06-11T23:13:00+09:00</updated><id>http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C18DB%ED%85%8C%EC%9D%B4%EB%B8%94%ED%8C%8C%EC%9D%BC%EC%A0%80%EC%9E%A5</id><content type="html" xml:base="http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C18DB%ED%85%8C%EC%9D%B4%EB%B8%94%ED%8C%8C%EC%9D%BC%EC%A0%80%EC%9E%A5/"><![CDATA[<h2 id="file-upload-취약점-제거">File Upload 취약점 제거</h2>

<ul>
  <li>업로드되는 파일을 DB 테이블에 저장하면 된다.</li>
  <li>File Upload 취약점을 없애기 위하여 업로드 파일 저장 위치를 db 테이블로 바꿔준다.</li>
  <li>즉, 웹 서버에 파일을 바로 저장하지 않고 DB 테이블에 바이너리 형태로 저장해준다.</li>
</ul>

<h2 id="sql-테이블에-데이터-파일--저장">SQL 테이블에 데이터( 파일 ) 저장</h2>

<h3 id="게시글-테이블">게시글 테이블</h3>

<h4 id="게시글-테이블-추가-컬럼">게시글 테이블 추가 컬럼</h4>
<ul>
  <li>업로드 파일 수 추가. 컬럼 디펄트 값 0</li>
  <li>파일 sid 컬럼을 추가. 컬럼 디펄트 값 “[]”</li>
</ul>

<h4 id="컬럼-추가-sql">컬럼 추가 SQL</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">alter</span> <span class="k">table</span> <span class="n">notice_board</span> <span class="k">add</span> <span class="n">file_cnt</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">default</span> <span class="mi">0</span> <span class="k">not</span> <span class="k">null</span><span class="p">;</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">notice_board</span> <span class="k">add</span> <span class="n">file_sids</span> <span class="n">NVARCHAR2</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">default</span> <span class="s1">'[]'</span> <span class="k">not</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="file_cnt-추가-sql">file_cnt 추가 SQL</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">update</span> <span class="n">notice_board</span> <span class="k">set</span> <span class="n">file_cnt</span><span class="o">=?</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=?</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="file_sids-리스트-추가-sql">file_sids 리스트 추가 SQL</h4>
<ul>
  <li>file_sids 에는 파일 sid 들의 리스트를 string 형태로 저장한다.</li>
  <li>예를 들면 <code class="language-plaintext highlighter-rouge">[1, 2, 3]</code> 이런식으로 저장한다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">update</span> <span class="n">notice_board</span> <span class="k">set</span> <span class="n">file_sids</span><span class="o">=?</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=?</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="file-sid-list-및-file-cnt-동시에-추가하기">file sid list 및 file cnt 동시에 추가하기.</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">update</span> <span class="n">notice_board</span> <span class="k">set</span> <span class="n">file_cnt</span><span class="o">=?</span><span class="p">,</span><span class="n">file_sids</span><span class="o">=?</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=?</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="파일-sid-리스트-불러오기">파일 sid 리스트 불러오기</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">file_sids</span> <span class="k">from</span> <span class="n">notice_board</span> <span class="k">where</span> <span class="n">sid</span> <span class="o">=</span> <span class="o">?</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="파일-테이블">파일 테이블</h3>

<h4 id="컬럼">컬럼</h4>

<ul>
  <li>sid ( PRIMARY KEY )</li>
  <li>사용자 sid ( 외래키 )</li>
  <li>게시글 sid ( 외래키 )</li>
  <li>파일 이름</li>
  <li>파일 바이너리</li>
</ul>

<h4 id="file-테이블-만들기">FILE 테이블 만들기</h4>
<ul>
  <li>게시글이나 사용자 계정을 삭제하기 전에 notice_file 테이블에서 게시글, 사용자 계정과 관련된 데이터 부터 삭제해야 한다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">notice_file</span> <span class="p">(</span>
    <span class="n">sid</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">user_sid</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">notice_board_sid</span> <span class="n">NUMBER</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">file_name</span> <span class="n">NVARCHAR2</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
    <span class="n">file_content</span> <span class="nb">blob</span><span class="p">,</span>
    <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">user_sid</span><span class="p">)</span> <span class="k">references</span> <span class="n">users</span> <span class="p">(</span><span class="n">sid</span><span class="p">),</span>
    <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">notice_board_sid</span><span class="p">)</span> <span class="k">references</span> <span class="n">notice_board</span> <span class="p">(</span><span class="n">sid</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<h4 id="notice_file-테이블-데이터-insert">notice_file 테이블 데이터 insert</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">insert</span> <span class="k">into</span> 
<span class="n">notice_file</span> <span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">user_sid</span><span class="p">,</span> <span class="n">notice_board_sid</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_content</span><span class="p">)</span>
<span class="k">values</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="notice_file-테이블-데이터-delete">notice_file 테이블 데이터 delete</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">delete</span> <span class="k">from</span> <span class="n">notice_file</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=?</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">delete</span> <span class="k">from</span> <span class="n">notice_file</span> <span class="k">where</span> <span class="n">notice_board_sid</span><span class="o">=?</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">delete</span> <span class="k">from</span> <span class="n">notice_file</span> <span class="k">where</span> <span class="n">user_sid</span><span class="o">=?</span>
</code></pre></div></div>

<h4 id="파일-이름-찾기">파일 이름 찾기</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">file_name</span> <span class="k">from</span> <span class="n">notice_file</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=?</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="파일-찾기">파일 찾기</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">file_content</span> <span class="k">from</span> <span class="n">notice_file</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=?</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="파일-새로운-게시글로-이전하기">파일 새로운 게시글로 이전하기</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">update</span> <span class="n">notice_file</span> <span class="k">set</span> <span class="n">notice_board_sid</span><span class="o">=?</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=?</span> <span class="p">;</span>
</code></pre></div></div>

<h4 id="파일-업로드-사용자-sid-가져오기">파일 업로드 사용자 sid 가져오기</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">user_sid</span> <span class="k">from</span> <span class="n">notice_file</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=?</span> <span class="p">;</span>
</code></pre></div></div>

<h2 id="업로드-과정">업로드 과정</h2>

<ul>
  <li>
    <p>게시글 성공적으로 업로드.<br /><img class="mermaid" src="https://mermaid.ink/svg/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG7sgqzsmqnsnpAgLT4-IOybuSDshJzrsoQgOiDqsozsi5zquIAg7J6R7ISxIOuwjyDtjIzsnbwg7JeF66Gc65OcIOyalOyyrVxu7Ju5IOyEnOuyhCAtPj4gREIg7ISc67KEIDog6rKM7Iuc6riAIOyggOyepSDsmpTssq1cbkRCIOyEnOuyhCAtPj4g7Ju5IOyEnOuyhCA6IOyggOyepSDsmYTro4wg7J2R64u1XG7sm7kg7ISc67KEIC0-PiBEQiDshJzrsoQgOiDtjIzsnbwg7YWM7J2067iU7JeQIO2MjOydvCDsoIDsnqUg7JqU7LKtXG5EQiDshJzrsoQgLT4-IOybuSDshJzrsoQgOiDtjIzsnbwg7YWM7J2067iUIHNpZCDsnZHri7VcbuybuSDshJzrsoQgLT4-IOybuSDshJzrsoQgOiBzaWQg66as7Iqk7Yq47JeQIOyggOyepVxu7Ju5IOyEnOuyhCAtPj4gREIg7ISc67KEIDog6rKM7Iuc6riAIO2MjOydvCBzaWQg66as7Iqk7Yq4IOyggOyepS4g7YyM7J28IOyImCDsoIDsnqUg7JqU7LKtXG5EQiDshJzrsoQgLT4-IOybuSDshJzrsoQgOiDsoIDsnqUg7JmE66OMIOydkeuLtVxu7Ju5IOyEnOuyhCAtPj4g7IKs7Jqp7J6QIDog6rKM7Iuc6riAIOyekeyEsSDsmYTro4wg7J2R64u1LiIsIm1lcm1haWQiOm51bGx9" /></p>
  </li>
  <li>
    <p>게시글 삭제 과정<br /><img class="mermaid" src="https://mermaid.ink/svg/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG7sgqzsmqnsnpAgLT4-IOybuSDshJzrsoQgOiDqsozsi5zquIAg7IKt7KCcIOyalOyyrVxu7Ju5IOyEnOuyhCAtPj4gREIg7ISc67KEIDog6rKM7Iuc6riA6rO8IOq0gOugqOuQnCDsoovslYTsmpQg7YWM7J2067iUIOuNsOydtO2EsCDsgq3soJwg7JqU7LKtXG5EQiDshJzrsoQgLT4-IOybuSDshJzrsoQgOiDsgq3soJwg7JmE66OMIOydkeuLtVxu7Ju5IOyEnOuyhCAtPj4gREIg7ISc67KEIDog6rKM7Iuc6riA6rO8IOq0gOugqOuQnCDtjIzsnbwg7YWM7J2067iUIOuNsOydtO2EsCDsgq3soJwg7JqU7LKtXG5EQiDshJzrsoQgLT4-IOybuSDshJzrsoQgOiDsgq3soJwg7JmE66OMIOydkeuLtVxu7Ju5IOyEnOuyhCAtPj4gREIg7ISc67KEIDog6rKM7Iuc6riAIOyCreygnCDsmpTssq1cbkRCIOyEnOuyhCAtPj4g7Ju5IOyEnOuyhCA6IOyCreygnCDsmYTro4wg7J2R64u1XG7sm7kg7ISc67KEIC0-PiDsgqzsmqnsnpAgOiDqsozsi5zquIAg7IKt7KCcIOyZhOujjCDsnZHri7UiLCJtZXJtYWlkIjpudWxsfQ" /></p>
  </li>
  <li>
    <p>사용자 계정 삭제 과정<br /><img class="mermaid" src="https://mermaid.ink/svg/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG7sgqzsmqnsnpAgLT4-IOybuSDshJzrsoQgOiDqs4TsoJUg7IKt7KCcIOyalOyyrVxu7Ju5IOyEnOuyhCAtPj4gREIg7ISc67KEIDog7IKs7Jqp7J6Q7JmAIOq0gOugqOuQnCDsoovslYTsmpQg7KCV67O0IOyCreygnFxuREIg7ISc67KEIC0-PiDsm7kg7ISc67KEIDog7IKt7KCcIOyZhOujjCDsnZHri7VcbuybuSDshJzrsoQgLT4-IERCIOyEnOuyhCA6IOyCrOyaqeyekOqwgCDsnpHshLHtlZwg6rKM7Iuc6riA6rO8IOq0gOugqOuQnCDsoovslYTsmpQg7KCV67O0IOyCreygnCDsmpTssq1cbkRCIOyEnOuyhCAtPj4g7Ju5IOyEnOuyhCA6IOyCreygnCDsmYTro4wg7J2R64u1XG7sm7kg7ISc67KEIC0-PiBEQiDshJzrsoQgOiDsgqzsmqnsnpDqsIAg7J6R7ISx7ZWcIOqyjOyLnOq4gOqzvCDqtIDroKjrkJwg7YyM7J28IOygleuztCDsgq3soJwg7JqU7LKtXG5EQiDshJzrsoQgLT4-IOybuSDshJzrsoQgOiDsgq3soJwg7JmE66OMIOydkeuLtVxu7Ju5IOyEnOuyhCAtPj4gREIg7ISc67KEIDog7IKs7Jqp7J6Q6rCAIOyekeyEse2VnCDqsozsi5zquIAg7IKt7KCcIOyalOyyrVxuREIg7ISc67KEIC0-PiDsm7kg7ISc67KEIDog7IKt7KCcIOyZhOujjCDsnZHri7VcbuybuSDshJzrsoQgLT4-IERCIOyEnOuyhCA6IOyCrOyaqeyekCDqs4TsoJUg7IKt7KCcXG5EQiDshJzrsoQgLT4-IOybuSDshJzrsoQgOiDsgq3soJwg7JmE66OMIOydkeuLtVxu7Ju5IOyEnOuyhCAtPj4g7IKs7Jqp7J6QIDog6rOE7KCVIOyCreygnCDsmYTro4wg7J2R64u1IiwibWVybWFpZCI6bnVsbH0" /></p>
  </li>
</ul>

<h2 id="servlet-java-코드">Servlet Java 코드</h2>

<h3 id="mainpagejava">MainPage.java</h3>
<ul>
  <li>파일 업로드 및 새로운 글 저장할 때.  파일 저장하는 부분을 수정하여 웹 서버에 파일을 저장하지 않고 DB 테이블에 파일을 저장하였다.</li>
  <li>파일을 바이너리 형태로 DB 테이블에 저장한다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainPage</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span><span class="o">{</span>
<span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">uriSearch</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> 
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 새로운 글 저장</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"POST"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noticeBoardSave</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// ***** 파일 업로드 시작 *****</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"no file"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 올바른 파일인지 확인하고 db에 저장한다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParts</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">for</span><span class="o">(</span><span class="kt">var</span> <span class="nl">part:</span><span class="n">parts</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(!</span><span class="n">part</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="s">"filename="</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">continue</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">part</span><span class="o">.</span><span class="na">getSubmittedFileName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">continue</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 이름에 금지된 문자가 사용되면 파일 업로드 안하기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">notCorrectFileName</span><span class="o">(</span><span class="n">part</span><span class="o">.</span><span class="na">getSubmittedFileName</span><span class="o">())){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">continue</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
  
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">fileSidList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="no">MAX_FILE_NUM</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file max number"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">break</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 데이터 DB 테이블에 저장하기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoticeFileDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">()).</span><span class="na">saveNoticeFile</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getSid</span><span class="o">(),</span> <span class="n">noticeSid</span><span class="o">,</span> <span class="n">part</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">part</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span> <span class="c1">// 임시파일 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">re</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"업로드 성공"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file upload success"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileSidList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">re</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">else</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"파일 업로드 실패"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file upload fail"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 게시글 file list 와 저장된 파일 갯수 저장하기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">notice</span><span class="o">.</span><span class="na">updateFileListAndCnt</span><span class="o">(</span><span class="n">fileSidList</span><span class="o">,</span> <span class="n">noticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"파일 업로드 실패"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file upload fail"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// ***** 파일 업로드 end *****</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
</code></pre></div></div>

<ul>
  <li>게시글 테이블에 저장된 첨부파일 SID를 이용하여 파일 이름과 링크를 만들어 보여준다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/66b12403-73ac-4b8f-8c3a-1374fbdac6cc" alt="Pasted image 20230611192027" /><br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/01218155-6ede-4580-b817-01b09eafddd1" alt="Pasted image 20230611192119" /></li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 글 자세히 보기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"GET"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noticeBoardDetail</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// *** 파일들 읽어 오기 ***</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 이름 찾기 및 href 링크 만들기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileNameList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">getFileSidList</span><span class="o">(</span><span class="n">noticeSID</span><span class="o">);</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeFileDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoticeFileDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">for</span><span class="o">(</span><span class="kt">var</span> <span class="nl">fileSid:</span><span class="n">fileSidList</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">noticeFileDAO</span><span class="o">.</span><span class="na">getFileName</span><span class="o">(</span><span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileNameList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">fileName</span><span class="o">,</span><span class="n">fileSid</span><span class="o">.</span><span class="na">toString</span><span class="o">()));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"fileNameList"</span><span class="o">,</span> <span class="n">fileNameList</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noticeBoardFileDownload"</span><span class="o">,</span> <span class="n">noticeBoardFileDownload</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// *** 파일들 읽어 오기 end ***</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
</code></pre></div></div>

<ul>
  <li>게시글을 수정할 때 게시글이 가지고 있는 업로드 파일을 삭제하거나 다운 받을 수 있는 링크를 보여준다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/2ccdb3ea-70f9-4151-91dd-789c71292f1f" alt="Pasted image 20230611192607" /></li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// mod 2 글 수정 하기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"GET"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noticeBoardModify</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// *** 파일들 읽어 오기 ***</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 이름 찾기 및 href 링크 만들기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileNameList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">getFileSidList</span><span class="o">(</span><span class="n">noticeSID</span><span class="o">);</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeFileDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoticeFileDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">for</span><span class="o">(</span><span class="kt">var</span> <span class="nl">fileSid:</span><span class="n">fileSidList</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">noticeFileDAO</span><span class="o">.</span><span class="na">getFileName</span><span class="o">(</span><span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileNameList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">fileName</span><span class="o">,</span><span class="n">fileSid</span><span class="o">.</span><span class="na">toString</span><span class="o">()));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"fileNameList"</span><span class="o">,</span> <span class="n">fileNameList</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noticeBoardFileDownload"</span><span class="o">,</span> <span class="n">noticeBoardFileDownload</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"noticeBoardFileDelete"</span><span class="o">,</span> <span class="n">noticeBoardFileDelete</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// *** 파일들 읽어 오기 end ***</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
</code></pre></div></div>

<ul>
  <li>게시글 수정을 완료하고 저장을 할 때 동작 순서의 변화가 있었다.</li>
  <li>새롭게 업로드한 파일도 DB 파일 테이블에 저장해 준다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 글 수정 저장하기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"POST"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noticeBoardModifySave</span><span class="o">))</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 1. 전 저장위치</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeSID</span> <span class="o">=</span> <span class="n">notice</span><span class="o">.</span><span class="na">getSid</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 2. 새로운 글 저장</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">genTime</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">newNoticeSid</span> <span class="o">=</span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">saveNotice</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">title</span><span class="o">,</span> <span class="n">mainText</span><span class="o">,</span> <span class="n">genTime</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">newNoticeSid</span><span class="o">==</span><span class="mi">0</span><span class="o">){</span> <span class="c1">// 실패</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">result</span> <span class="o">=</span> <span class="s">"&lt;script&gt;alert('fail');location.href='"</span><span class="o">+</span><span class="n">noticeBoard</span><span class="o">+</span><span class="s">"'&lt;/script&gt;"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 3. 이전 게시글 파일 새로운 글로 이전</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// notice_board_sid 새로운 글 sid로 바꾸기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">getFileSidList</span><span class="o">(</span><span class="n">noticeSID</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">updateFileListAndCnt</span><span class="o">(</span><span class="n">fileSidList</span><span class="o">,</span> <span class="n">newNoticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoticeFileDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">for</span><span class="o">(</span><span class="kt">var</span> <span class="nl">fileSid:</span><span class="n">fileSidList</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileDAO</span><span class="o">.</span><span class="na">changeNoticeSid</span><span class="o">(</span><span class="n">fileSid</span><span class="o">,</span> <span class="n">newNoticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 4. 이전 글 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(!</span><span class="n">noticeDAO</span><span class="o">.</span><span class="na">deleteNotice</span><span class="o">(</span><span class="n">sid</span><span class="o">)){</span> <span class="c1">// 삭제 실패</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 5. ***** 파일 업로드 시작 *****</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"no new file"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 올바른 파일인지 확인하고 db에 저장한다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParts</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">for</span><span class="o">(</span><span class="kt">var</span> <span class="nl">part:</span><span class="n">parts</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(!</span><span class="n">part</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="s">"filename="</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">continue</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">part</span><span class="o">.</span><span class="na">getSubmittedFileName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">continue</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 이름에 금지된 문자가 사용되면 파일 업로드 안하기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">notCorrectFileName</span><span class="o">(</span><span class="n">part</span><span class="o">.</span><span class="na">getSubmittedFileName</span><span class="o">())){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">continue</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">fileSidList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="no">MAX_FILE_NUM</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file max number"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">break</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 데이터 DB 테이블에 저장하기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoticeFileDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">()).</span><span class="na">saveNoticeFile</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getSid</span><span class="o">(),</span> <span class="n">newNoticeSid</span><span class="o">,</span> <span class="n">part</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">part</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span> <span class="c1">// 임시파일 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">re</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"업로드 성공"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"file upload success"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileSidList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">re</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">else</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"파일 업로드 실패"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"new file upload fail"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 게시글 file list 와 저장된 파일 갯수 저장하기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">updateFileListAndCnt</span><span class="o">(</span><span class="n">fileSidList</span><span class="o">,</span> <span class="n">newNoticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"파일 업로드 실패"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeRe</span> <span class="o">=</span> <span class="s">"new file upload fail"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// ***** 파일 업로드 end *****</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
</code></pre></div></div>

<ul>
  <li>게시글에서 파일 다운로드 링크를 눌러 파일을 다운로드 받을 때 웹 서버의 폴더에서 파일을 가져오는 것이 아닌 DB 파일 테이블에서 파일을 가지고 온다.</li>
  <li>주의해야 할 점은 파일 다운로드가 다 될때 까지는 DB와의 연결이 끊겨서는 안된다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 게시글 파일 다운로드</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noticeBoardFileDownload</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">long</span> <span class="n">pageSid</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">long</span> <span class="n">fileSid</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pageSid</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"pageid"</span><span class="o">));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileSid</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"downlink"</span><span class="o">));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoticeBoardDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">notice</span> <span class="o">=</span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">getNotice</span><span class="o">(</span><span class="n">pageSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">notice</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoticeFileDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">is</span> <span class="o">=</span> <span class="n">fileDAO</span><span class="o">.</span><span class="na">getFile</span><span class="o">(</span><span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">is</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSize</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">available</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">fileDAO</span><span class="o">.</span><span class="na">getFileName</span><span class="o">(</span><span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 사용자에게 다운로드 보내기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">sMimeType</span> <span class="o">=</span> <span class="n">getServletContext</span><span class="o">().</span><span class="na">getMimeType</span><span class="o">(</span><span class="n">fileName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">sMimeType</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">sMimeType</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">sMimeType</span> <span class="o">=</span> <span class="s">"application/octet-stream"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">BufferedOutputStream</span> <span class="n">outs</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">sMimeType</span><span class="o">+</span><span class="s">"; charset=utf-8"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">fileSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">response</span><span class="o">.</span><span class="na">setContentLength</span><span class="o">(</span><span class="n">fileSize</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">userAgent</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"User-Agent"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">userAgent</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">userAgent</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">userAgent</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"MSIE 5.5"</span><span class="o">)){</span> <span class="c1">// MSIE 5.5 이하</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">userAgent</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">userAgent</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"MSIE"</span><span class="o">)){</span> <span class="c1">// MS IE</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">else</span><span class="o">{</span> <span class="c1">// 모질라</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span> <span class="s">"attachment; filename="</span><span class="o">+</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">fileName</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">"utf-8"</span><span class="o">),</span> <span class="s">"latin1"</span><span class="o">)</span> <span class="o">+</span> <span class="s">";"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 사용자에게 파일을 전송한다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">outs</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedOutputStream</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">int</span> <span class="n">read</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">8192</span><span class="o">];</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">while</span><span class="o">((</span><span class="n">read</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">b</span><span class="o">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">outs</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">read</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">outs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 다운로드 완료 된후 DB 연결을 해제해야한다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileDAO</span><span class="o">.</span><span class="na">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"사용자 파일 다운로드 "</span><span class="o">+</span> <span class="n">pageSid</span> <span class="o">+</span> <span class="s">"  "</span><span class="o">+</span> <span class="n">fileSize</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>게시글 수정 페이지에서 파일 삭제 버튼을 눌러 파일을 삭제할 때 사용자로 부터 받은 게시글 sid 와 파일 sid를 이용하여  파일 테이블에 저장된 파일 삭제해준다.</li>
  <li>파일을 삭제하기 전 파일을 삭제하는 권환을 가지고 있는지 확인한다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"GET"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">noticeBoardFileDelete</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="s">"fail"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeSid</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"noticeID"</span><span class="o">));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSid</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"filename"</span><span class="o">));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">noticeDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoticeBoardDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">notice</span> <span class="o">=</span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">getNotice</span><span class="o">(</span><span class="n">noticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 게시글 존재하는지 확인하기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 글 작성자와 현재 유저가 일지하는지 확인</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> 
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 업로드 파일 사용자 확인</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NoticeFileDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getSid</span><span class="o">()</span> <span class="o">!=</span> <span class="n">fileDAO</span><span class="o">.</span><span class="na">getUploadUser</span><span class="o">(</span><span class="n">fileSid</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"글 작성자와 파일 업로드 사용자 명과 일치 안함"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"{\"result\":\"fail\"}"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(!</span><span class="n">fileDAO</span><span class="o">.</span><span class="na">deleteFile</span><span class="o">(</span><span class="n">fileSid</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="s">"{\"result\":\"fail\"}"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 삭제 end</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="s">"success"</span><span class="o">;</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">getFileSidList</span><span class="o">(</span><span class="n">noticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileSidList</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">noticeDAO</span><span class="o">.</span><span class="na">updateFileListAndCnt</span><span class="o">(</span><span class="n">fileSidList</span><span class="o">,</span> <span class="n">noticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"삭제 완료!"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="s">"fail"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> 
</code></pre></div></div>

<h3 id="noticeboarddaojava">NoticeBoardDAO.java</h3>

<ul>
  <li>전에는 게시글을 삭제할 때 게시글과 함께 게시글 업로드 폴더를 삭제 하였지만 현재는 게시글과 관련이 있는 DB 파일 테이블의 데이터를 삭제하면 된다.</li>
  <li>게시글을 삭제하기 전에 업로드 파일 부터 삭제하여야 한다. 그렇지 않으면 무결성 오류가 발생한다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/4b9491cf-39f1-4724-b831-62c445ea5792" alt="Pasted image 20230611201006" /></li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoticeBoardDAO</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="c1">// 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">deleteNotice</span><span class="o">(</span><span class="kt">long</span> <span class="n">sid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 좋아요 테이블에서 게시글과 관련된 좋아요 기록 모두 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">new</span> <span class="nc">NoticeLikeDAO</span><span class="o">(</span><span class="n">context</span><span class="o">).</span><span class="na">deleteNoticeLike</span><span class="o">(</span><span class="n">sid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 업로드 파일 부터 삭제한다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">new</span> <span class="nc">NoticeFileDAO</span><span class="o">(</span><span class="n">context</span><span class="o">).</span><span class="na">deleteNoticeFile</span><span class="o">(</span><span class="n">sid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
</code></pre></div></div>

<ul>
  <li>게시글과 관련된 파일 sid 리스트를 String 타입으로 게시글에 저장해 주었다. 그리고 업로드 파일이 몇 개 인지도 저장해 주었다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="c1">// file list 저장 및 저장된 파일 수 저장</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">updateFileListAndCnt</span><span class="o">(</span><span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">fileSidList</span><span class="o">,</span> <span class="kt">long</span> <span class="n">noticeSid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"update "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" set file_cnt=?,file_sids=? where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">fileSidList</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">fileSidList</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">noticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>게시글에 저장된 파일 sid 리스트 String을 ArrayList로 변환해준다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="c1">// get file sid list</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="nf">getFileSidList</span><span class="o">(</span><span class="kt">long</span> <span class="n">noticeSid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"select file_sids from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">noticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">String</span> <span class="n">listStr</span> <span class="o">=</span> <span class="s">"[]"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">re</span><span class="o">.</span><span class="na">next</span><span class="o">()){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">listStr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="n">strToArrayList</span><span class="o">(</span><span class="n">listStr</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileSidList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">fileSidList</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>String 타입을 ArrayList로 변환해준다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="kd">private</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="nf">strToArrayList</span><span class="o">(</span><span class="nc">String</span> <span class="n">listStr</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">arr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">listStr</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">arr</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">listStr</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">listStr</span><span class="o">.</span><span class="na">length</span><span class="o">()-</span><span class="mi">1</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="s">", "</span><span class="o">)).</span><span class="na">map</span><span class="o">(</span><span class="nl">Long:</span><span class="o">:</span><span class="n">parseLong</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">()));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">arr</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="noticefiledaojava">NoticeFileDAO.java</h3>

<ul>
  <li>실제 DB 와 상호작용 할 수 있는 함수이다.</li>
  <li>DB 테이블의 파일을 삭제, 저장을 할 수 있다.</li>
  <li>파일 이름이나 파일이 속한 게시글 sid, 사용자 sid 를 알 수 있다.</li>
  <li>테이블에 저장된 바이너리 형태의 파일을 불러올 수 있다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoticeFileDAO</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">private</span> <span class="nc">String</span> <span class="n">tableName</span> <span class="o">=</span> <span class="s">"notice_file"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">private</span> <span class="nc">Connection</span> <span class="n">conn</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">private</span> <span class="nc">DBConnection</span> <span class="n">dbConn</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="nf">NoticeFileDAO</span><span class="o">(</span><span class="nc">ServletContext</span> <span class="n">context</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">dbConn</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DBConnection</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">"noticeBoard"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">long</span> <span class="nf">saveNoticeFile</span><span class="o">(</span><span class="kt">long</span> <span class="n">userSid</span><span class="o">,</span> <span class="kt">long</span> <span class="n">noticeBoardSid</span><span class="o">,</span> <span class="nc">Part</span> <span class="n">part</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">long</span> <span class="n">re</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">sid</span> <span class="o">=</span> <span class="n">genSid</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"insert into "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" (sid, user_sid, notice_board_sid, file_name, file_content) values(?,?,?,?,?)"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">sid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">userSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">noticeBoardSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="n">part</span><span class="o">.</span><span class="na">getSubmittedFileName</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setBinaryStream</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="n">part</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">(),</span> <span class="n">part</span><span class="o">.</span><span class="na">getSize</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="n">sid</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="c1">// 게시글 에 속한 파일 삭제하기.</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteNoticeFile</span><span class="o">(</span><span class="kt">long</span> <span class="n">noticeSid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"delete from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" where notice_board_sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">noticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getFileName</span><span class="o">(</span><span class="kt">long</span> <span class="n">sid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">"none"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"select file_name from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">sid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">re</span><span class="o">.</span><span class="na">next</span><span class="o">()){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fileName</span><span class="o">=</span><span class="s">"none"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 다운로드 </span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="nc">InputStream</span> <span class="nf">getFile</span><span class="o">(</span><span class="kt">long</span> <span class="n">fileSid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">InputStream</span> <span class="n">re</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"select file_content from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">next</span><span class="o">()){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">blob</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getBlob</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="na">getBinaryStream</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 다운로드가 완료 되기 전까지 DB연결이 해제되어야 한다.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// finally {</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">//     Close();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// }</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일이 속하는 게시글 번호 바꾸기</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">changeNoticeSid</span><span class="o">(</span><span class="kt">long</span> <span class="n">fileSid</span><span class="o">,</span> <span class="kt">long</span> <span class="n">newNoticeSid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"update "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" set notice_board_sid=? where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">newNoticeSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 sid 로 삭제</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">deleteFile</span><span class="o">(</span><span class="kt">long</span> <span class="n">fileSid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"delete from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="c1">// 파일 업로드 사용자 sid</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getUploadUser</span><span class="o">(</span><span class="kt">long</span> <span class="n">fileSid</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">long</span> <span class="n">re</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"select user_sid from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">fileSid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">next</span><span class="o">()){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">private</span> <span class="kt">long</span> <span class="nf">genSid</span><span class="o">(){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">long</span> <span class="n">sid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Connection</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"select coalesce(max(sid),-1) from "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">next</span><span class="o">()){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">sid</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">sid</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="kd">private</span> <span class="kt">void</span> <span class="nf">Connection</span><span class="o">(){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">conn</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="na">connectDB</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">Close</span><span class="o">(){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="발생한-오류">발생한 오류</h2>

<h3 id="ora-00904-notice_file-invalid-identifier">ORA-00904: “NOTICE_FILE”: invalid identifier</h3>
<ul>
  <li>notice_file 테이블에 파일 저장 컬럼의 이름이 <strong>file_content</strong> ( BLOB ) 인데 notice_file 로 컬럼 이름을 잘못적어 발생한 오류이다. 컬럼 이름을 바르게 바꿔주면 해당 오류는 사라진다.</li>
  <li>notice_file 이라는 컬럼이 존재하지 않는다는 뜻이다.</li>
</ul>

<h3 id="javalangclasscastexception">java.lang.ClassCastException</h3>
<ul>
  <li>class javax.sql.rowset.serial.SerialBlob cannot be cast to class oracle.jdbc.internal.OracleBlob</li>
  <li>이 에러는 어떻게 해결해야 하는지 모르겠다. 그냥 SerialBlob 을 사용하지않고 다른 방법을 이용하였다.</li>
</ul>

<h3 id="javaioioexception-ora-17008-closed-connection">java.io.IOException: ORA-17008: Closed connection</h3>
<ul>
  <li>java.sql.SQLRecoverableException: ORA-17008: Closed connection</li>
  <li>DB 와 연결이 끊어져서 발생한 문제이다.</li>
  <li>작업을 마칠 때 까지 DB 연결을 끊어서는 안된다.</li>
</ul>

<h2 id="참고-사이트">참고 사이트</h2>
<ul>
  <li><a href="https://gent.tistory.com/323">오라클 컬럼(Column) 추가, 삭제 방법 (컬럼 순서 변경) (tistory.com)</a></li>
  <li><a href="https://llorllale.github.io/posts/oracles-jdbc-blob-support-sucks/">Oracle’s JDBC BLOB support sucks….  George Aristy (llorllale.github.io)</a></li>
  <li><a href="https://www.codejava.net/java-ee/servlet/java-servlet-to-download-file-from-database">Java servlet to download file from database (codejava.net)</a></li>
  <li><a href="https://www.javaguides.net/2019/09/upload-file-to-database-with-servlet-jsp-jdbc-mysql-using-blob.html">Upload File to Database with Servlet and MySQL using BLOB (javaguides.net)</a></li>
  <li><a href="https://blog.miyam.net/120">Oracle 에서 Java를 사용하여 Blob형을 파일로 저장하기 (miyam.net)</a></li>
</ul>]]></content><author><name>Jung MinGyu</name></author><category term="file upload" /><category term="file download" /><category term="웹 서버" /><category term="servlet" /><category term="java" /><summary type="html"><![CDATA[업로드 파일을 웹 서버에 저장하지 않고 DB 테이블에 저장해보자.]]></summary></entry><entry><title type="html">File Upload, LFI, RFI, File Download 공격 정리</title><link href="http://localhost:4000/FileUploadLFIRFIFileDownload/" rel="alternate" type="text/html" title="File Upload, LFI, RFI, File Download 공격 정리" /><published>2023-06-09T00:00:00+09:00</published><updated>2023-06-09T23:13:00+09:00</updated><id>http://localhost:4000/FileUploadLFIRFIFileDownload</id><content type="html" xml:base="http://localhost:4000/FileUploadLFIRFIFileDownload/"><![CDATA[<h2 id="file-upload">File Upload</h2>

<h3 id="file-upload-공격-이란">File Upload 공격 이란?</h3>
<ul>
  <li>공격자가 임의의 파일을 업로드하는 공격이다.</li>
  <li>서버 측에서 실행 가능한 파일 올리기 공격이다.</li>
</ul>

<h3 id="취약점-발생-이유">취약점 발생 이유</h3>
<ul>
  <li>업로드 되는 파일을 검증하지 않아서 발생하는 취약점이다.</li>
</ul>

<h3 id="공격-시나리오">공격 시나리오</h3>
<ul>
  <li><strong>웹 쉘 업로드</strong>. 파일 업로드 위치와 업로드한 파일을 실행할 수 있는지 알아야 한다.</li>
  <li><strong>디페이스 공격</strong>. index.html 파일을 업로드하여 메인페이지를 바꾸는 공격이다.</li>
  <li>페이지 변조 및 피싱 공격.</li>
  <li>악성코드 유포 ( 페이지에 XSS 넣기 )</li>
</ul>

<h3 id="대응-방법">대응 방법</h3>
<ol>
  <li>업로드 되는 파일을 DB 테이블에 저장하기. 즉 binary로 저장하기. ( CLOB or BLOB )</li>
  <li>파일 업로드 서버를 따로 두기. 즉 파일 업로드 서버에는 웹 서버 엔진( jsp, php 등 )이 설치되어 있으면 안된다.</li>
  <li>파일 검증하기. 확장자 검증, 파일 시그니쳐 검증, MIME TYPE 검증 ( Content-Type 검증 ).</li>
</ol>

<h2 id="lfi--local-file-inclusion-">LFI ( Local File Inclusion )</h2>
<ul>
  <li>웹 서버에서 사용하는  <code class="language-plaintext highlighter-rouge">include</code> 기능을 이용한 취약점이다.</li>
  <li>서버가 사용자로 부터 파일이름(include 할 파일)을 입력으로 받을 때 발생한다.</li>
  <li>파일 업로드 취약점의 자매품이다.</li>
  <li>파일 업로드 보다 상위 공격에 속한다.</li>
</ul>

<h3 id="include-동작-과정">Include 동작 과정</h3>
<p><img class="mermaid" src="https://mermaid.ink/svg/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG7sgqzsmqnsnpAgLT4-IOyEnOuyhCA6IO2OmOydtOyngCDsmpTssq1cbuyEnOuyhCAtPj4g7ISc67KEIDogaW5jbHVkZSDrkJwg66qo65OgIO2OmOydtOyngOulvCDrtojrn6zsmKTquLBcbuyEnOuyhCAtPj4g7ISc67KEIDog7Y6Y7J207KeAIOyLpO2WiSAoIOq3uOumrOq4sCApXG7shJzrsoQgLT4-IOyCrOyaqeyekCA6IOyZhOyEsSDtjpjsnbTsp4Ag7J2R64u1IiwibWVybWFpZCI6bnVsbH0" /></p>

<h3 id="공격-유형">공격 유형</h3>

<h4 id="이미지-웹-쉘">이미지 웹 쉘</h4>
<ul>
  <li>이미지 파일에 웹 쉘을 추가하는 공격이다. 즉 확장자는 바뀔 필요가 없다.</li>
  <li>이미지 파일 자체를 바로 실행하는 것은 불가능 하다.</li>
</ul>

<h5 id="이미지-웹-쉘-실행-방법">이미지 웹 쉘 실행 방법</h5>
<ol>
  <li>.htaccess 서버 설정파일 바꾸기.</li>
  <li>LFI 취약점 이용하기.</li>
</ol>

<h5 id="lfi-취약점-이용하기">LFI 취약점 이용하기.</h5>

<ul>
  <li>정상적인 페이지 요청.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?page=test.php
</code></pre></div></div>

<ul>
  <li>이미지 파일 맨 뒤에 웹 쉘 넣기.</li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span> <span class="cp">?&gt;</span>
</code></pre></div></div>

<ul>
  <li>웹 쉘이 들어있는 이미지 경로를 적어준다.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?page=이미지 경로/이미지.png
</code></pre></div></div>

<ul>
  <li>php 파일의 include에서 이미지 파일을 읽어온 다음 php 파일를 실행시켜 페이지를 완성시킨다.  이때 공격자의 웹쉘이 실행되는 공격법이다.</li>
</ul>

<h4 id="access-log-파일-이용하기">Access Log 파일 이용하기</h4>
<ul>
  <li>이 취약점을 이용하면 파일 업로드를 할 필요도 없다.</li>
  <li>공격자가 일부러 잘못된 요청을 보내어 오류를 로그에 기록하는 공격기법이다.</li>
  <li>잘못된 요청<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/b803bb0b-532b-40f8-a64e-fe7b4622beda" alt="Pasted image 20230609215043" /></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET &lt;?php echo system($_GET['cmd']); ?&gt; HTTP/1.1
Host: 221.27.0.6
</code></pre></div></div>

<ul>
  <li>
    <p>access.log 파일<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/a90447c3-63d8-4c4f-addd-f69dc9fd2843" alt="Pasted image 20230609215006" /></p>
  </li>
  <li>
    <p>LFI 취약점이 존재하는 페이지를 찾아 요청에 access.log 파일 경로를 넣어주면 된다.</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?page=로그파일 위치/access.log
</code></pre></div></div>

<h2 id="rfi--remote-file-inclusion-">RFI ( Remote File Inclusion )</h2>
<ul>
  <li>외부에서 파일을 가지고오는 공격이다.</li>
  <li>내부의 파일을 불러오는 것이아닌 외부의 파일을 불러와 페이지를 완성시킨다.</li>
  <li>
    <p>LFI 보다 공격하기 쉽다.</p>
  </li>
  <li>정상적 요청</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?page=www.gg.rr/file.php
</code></pre></div></div>

<ul>
  <li>비정상적 요청</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?page=공격자가 만든 웹쉥 php
</code></pre></div></div>

<h2 id="file-download-공격">File Download 공격</h2>

<h3 id="file-download-공격이란">File Download 공격이란?</h3>
<ul>
  <li>공격자가 원하는 임의의 파일을 다운로드 할 수 있는 공격이다.</li>
  <li>소스코드 정보를 탈취할 수 있다. 따라서 소스코드에 적힌 DB 계정 정보를 탈취할 수 있다.</li>
</ul>

<h3 id="file-download-유형">File Download 유형</h3>

<h4 id="링크를-통한-다운로드">링크를 통한 다운로드</h4>
<ul>
  <li>인가 취약점이 존재할 수 있다. 즉 허락받지 않은 사용자가 파일을 다운받을 수 있다.</li>
  <li>하지만 File Download 공격이 원천적으로 불가능 하다. 왜냐하면 url 경로를 통해 파일을 다운받기 때문이다.</li>
</ul>

<h4 id="다운로드-스크립트가-존재하는-경우">다운로드 스크립트가 존재하는 경우</h4>
<ul>
  <li><code class="language-plaintext highlighter-rouge">download.php?file=test.jpg</code> 로 파일을 다운받을 경우이다. <code class="language-plaintext highlighter-rouge">download.php</code> 스크립트가 존재한다.</li>
  <li>File Download 취약점이 존재할 수 있다.</li>
</ul>

<h3 id="file-download-취약점-찾기">File Download 취약점 찾기</h3>
<ol>
  <li>다운로드 스크립트가 존재하는지 확인한다. 스크립트가 없다면 다운로드 취약점은 존재하지 않는다.</li>
  <li>파라미터로 파일 이름을 받는지 아니면 파일 경로를 받는지 확인한다.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>download.php?idx=2 =&gt; 취약점 없다 (db 에 저장하는 것 같다)

여기서 sqli 취약점이 존재하면 다운로드 취약점이 존재할 수 있다.
</code></pre></div></div>

<ul>
  <li>sqli 취약점 이용하기. 서버에 저장된 파일 경로를 db 테이블에 저장하는 경우가 해당된다.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">path</span> <span class="k">from</span> <span class="n">board</span> <span class="k">where</span> <span class="n">idx</span><span class="o">=</span><span class="p">{}</span> 

<span class="o">?</span><span class="n">idx</span><span class="o">=</span><span class="mi">0</span> <span class="k">union</span> <span class="k">select</span> <span class="s1">'/etc/passwd'</span>

<span class="n">sqli</span> <span class="err">취약점을</span> <span class="err">이용하여</span> <span class="err">원하는</span> <span class="err">파일을</span> <span class="err">다운로드</span> <span class="err">한다</span><span class="p">.</span>
</code></pre></div></div>

<h3 id="대응-방법-1">대응 방법</h3>
<ol>
  <li>파일을 DB 테이블에 저장하기.</li>
  <li>파일 저장 위치를 물리적으로 분리시키기. ( NAS )</li>
  <li>디렉토리 traversal 막기. (  <code class="language-plaintext highlighter-rouge">../</code> 경로 이동 막기 )</li>
</ol>]]></content><author><name>Jung MinGyu</name></author><category term="file upload" /><category term="file download" /><category term="lfi" /><category term="rfi" /><summary type="html"><![CDATA[File Upload, LFI, RFI, File Download 공격에 대하여 알아보자.]]></summary></entry><entry><title type="html">웹 서버 개발 (17) 마이페이지</title><link href="http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C17%EB%A7%88%EC%9D%B4%ED%8E%98%EC%9D%B4%EC%A7%80/" rel="alternate" type="text/html" title="웹 서버 개발 (17) 마이페이지" /><published>2023-06-08T00:00:00+09:00</published><updated>2023-06-08T23:13:00+09:00</updated><id>http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C17%EB%A7%88%EC%9D%B4%ED%8E%98%EC%9D%B4%EC%A7%80</id><content type="html" xml:base="http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C17%EB%A7%88%EC%9D%B4%ED%8E%98%EC%9D%B4%EC%A7%80/"><![CDATA[<h2 id="마이페이지">마이페이지</h2>
<ul>
  <li>사용자 정보 확인 기능.</li>
  <li>사용자 정보 변경 기능.</li>
</ul>

<h2 id="사용자-정보-확인">사용자 정보 확인</h2>
<ul>
  <li>사용자는 아이디, 이메일, 주소를 확인할 수 있다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/1f3080f9-e247-473e-9242-0851b64eb35c" alt="Pasted image 20230608002224" /></li>
  <li>마이페이지 버튼을 눌러 마이페이지에 접속하면 사용자 정보를 확인가능하다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/a4b177b5-ce06-4d4b-bf2d-db87e497579e" alt="Pasted image 20230608002341" /></li>
</ul>

<h3 id="jsp-코드">JSP 코드</h3>

<h4 id="main_pagejsp">main_page.jsp</h4>

<ul>
  <li>마이페이지 버튼</li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"button-design"</span> <span class="na">href=</span><span class="s">"/main_page/my_page"</span><span class="nt">&gt;</span>마이페이지<span class="nt">&lt;/a&gt;</span>
</code></pre></div></div>

<ul>
  <li>servlet 이 넘겨준 menuNumber을 이용하여 마이페이지를 불러온다.</li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%</span> <span class="k">if</span><span class="o">(</span><span class="n">menuNumber</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;jsp:include </span><span class="na">page=</span><span class="s">"./sub_main/mypage.jsp"</span><span class="na"> flush=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;%</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">menuNumber</span> <span class="o">==</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span> <span class="nt">%&gt;</span>
</code></pre></div></div>

<h4 id="mypagejsp">mypage.jsp</h4>

<ul>
  <li>servlet을 통해 db 에 저장된 사용자 정보를 받아온다.</li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">contentType=</span><span class="s">"text/html;charset=UTF-8"</span><span class="na"> language=</span><span class="s">"java"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;%@ page </span><span class="na">import=</span><span class="s">"com.mingyu2.login.authentication.database.User"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%</span>
<span class="kt">var</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="nc">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
<span class="nt">%&gt;</span>
<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"border:1px solid #000000;margin:0 auto 0 auto; width: 60%;text-align: center;"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>사용자 정보<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;hr&gt;</span>
    <span class="nt">&lt;span&gt;</span>아이디 : <span class="nt">&lt;b&gt;&lt;%=</span><span class="n">user</span><span class="o">.</span><span class="na">getUsernameFilter</span><span class="o">()</span> <span class="nt">%&gt;&lt;/b&gt;&lt;/span&gt;&lt;br&gt;</span>
    <span class="nt">&lt;span&gt;</span>이메일 : <span class="nt">&lt;b&gt;&lt;%=</span><span class="n">user</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getEmail</span><span class="o">())</span> <span class="nt">%&gt;&lt;/b&gt;&lt;/span&gt;&lt;br&gt;</span>
    <span class="nt">&lt;span&gt;</span>우편번호 : <span class="nt">&lt;b&gt;&lt;%=</span><span class="n">user</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getAddressNumber</span><span class="o">())</span> <span class="nt">%&gt;&lt;/b&gt;&lt;/span&gt;&lt;br&gt;</span>
    <span class="nt">&lt;span&gt;</span>주소 : <span class="nt">&lt;b&gt;&lt;%=</span><span class="n">user</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getAddress</span><span class="o">())</span> <span class="nt">%&gt;&lt;/b&gt;&lt;/span&gt;&lt;br&gt;</span>
    <span class="nt">&lt;span&gt;</span>주소2 : <span class="nt">&lt;b&gt;&lt;%=</span><span class="n">user</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getAddressSub</span><span class="o">())</span> <span class="nt">%&gt;&lt;/b&gt;&lt;/span&gt;&lt;br&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"button-design"</span> <span class="na">style=</span><span class="s">"margin-top: 20px; margin-bottom:10px;"</span> <span class="na">id=</span><span class="s">"logout"</span> <span class="na">href=</span><span class="s">"/main_page/my_page/change_info"</span><span class="nt">&gt;</span>정보 수정<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<h3 id="servlet-코드">Servlet 코드</h3>

<h4 id="mainpagejava">MainPage.java</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainPage</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span><span class="o">{</span>
<span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">uriSearch</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">myPage</span> <span class="o">=</span> <span class="s">"/main_page/my_page"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 마이페이지</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">myPage</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 메뉴들</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">menus</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;&gt;&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">menus</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;&gt;(</span><span class="s">"Home"</span><span class="o">,</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;(</span><span class="s">"/main_page"</span><span class="o">,</span><span class="kc">false</span><span class="o">)));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">menus</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;&gt;(</span><span class="s">"게시판"</span><span class="o">,</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;(</span><span class="n">noticeBoard</span><span class="o">+</span><span class="n">baseNoticeBoardParameter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="s">""</span><span class="o">,</span><span class="s">""</span><span class="o">,</span><span class="s">""</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="kc">false</span><span class="o">)));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">menus</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;&gt;(</span><span class="s">"버튼2"</span><span class="o">,</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;(</span><span class="s">""</span><span class="o">,</span><span class="kc">false</span><span class="o">)));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">menus</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;&gt;(</span><span class="s">"버튼2"</span><span class="o">,</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;(</span><span class="s">""</span><span class="o">,</span><span class="kc">false</span><span class="o">)));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"menus"</span><span class="o">,</span> <span class="n">menus</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">mainPage</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h2 id="사용자-정보-변경">사용자 정보 변경</h2>
<ul>
  <li>사용자는 이메일, 주소, 비밀번호를 변경할 수 있다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/15cc24df-d584-4563-b29c-baba0923523a" alt="Pasted image 20230608003819" /></li>
  <li>정보 수정 버튼을 눌러 정보 수정 페이지로 들어간다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/a290a3a1-ce7a-4b9e-974e-af9dd61537a5" alt="Pasted image 20230608003941" /></li>
</ul>

<h3 id="정보-변경">정보 변경</h3>
<ul>
  <li>email 과 주소를 변경한다.</li>
</ul>

<h4 id="정보-변경-sql-문">정보 변경 SQL 문</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">update</span> <span class="n">users</span> 
<span class="k">set</span> <span class="n">email</span><span class="o">=</span><span class="s1">'이메일'</span><span class="p">,</span> <span class="err">우편번호</span><span class="o">=</span><span class="s1">'우편번호'</span><span class="p">,</span> <span class="err">주소</span><span class="o">=</span><span class="s1">'주소'</span><span class="p">,</span> <span class="err">주소</span><span class="mi">2</span><span class="o">=</span><span class="s1">'주소2'</span> 
<span class="k">where</span> <span class="n">sid</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="비밀번호-변경하기">비밀번호 변경하기</h3>
<ul>
  <li>비밀번호 변경은 중요한 요청이기 때문에 인증기능을 추가하였다.</li>
  <li>즉 현재 비밀번호를 입력하고 일치하여야 비밀번호가 변경된다.</li>
</ul>

<h4 id="비밀번호-변경-sql-문">비밀번호 변경 SQL 문</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">update</span> <span class="n">users</span> 
<span class="k">set</span> <span class="n">salt</span><span class="o">=</span><span class="nv">"새로운 salt"</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="nv">"해시화한 새로운 비번"</span><span class="p">,</span> <span class="n">modifi_time</span><span class="o">=</span><span class="err">변경시각</span> 
<span class="k">where</span> <span class="n">sid</span><span class="o">=</span><span class="mi">1</span> <span class="k">where</span> <span class="n">sid</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="jsp-코드-1">JSP 코드</h3>

<h4 id="main_pagejsp-1">main_page.jsp</h4>
<ul>
  <li>servlet 에서 받은 menuNumber을 이용하여 사용자 정보 변경 페이지로 들어간다.</li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">menuNumber</span> <span class="o">==</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;jsp:include </span><span class="na">page=</span><span class="s">"./sub_main/mypage_change_info.jsp"</span><span class="na"> flush=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;%</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">menuNumber</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span> <span class="nt">%&gt;</span>
</code></pre></div></div>

<h4 id="mypage_change_infojsp">mypage_change_info.jsp</h4>
<ul>
  <li>사용자 정보를 수정하는 페이지이다.</li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">contentType=</span><span class="s">"text/html;charset=UTF-8"</span><span class="na"> language=</span><span class="s">"java"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;%@ page </span><span class="na">import=</span><span class="s">"com.mingyu2.login.authentication.database.User"</span><span class="nt">%&gt;</span>
<span class="nt">&lt;%</span>
<span class="kt">var</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="nc">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
<span class="nt">%&gt;</span>
<span class="nt">&lt;style&gt;</span>
<span class="nc">.user-info-change</span> <span class="o">&gt;</span> <span class="nt">form</span> <span class="o">&gt;</span> <span class="nt">input</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">font-size</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;style&gt;</span>
<span class="nc">.modal</span><span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">display</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">position</span><span class="p">:</span> <span class="nb">fixed</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">z-index</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">right</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">overflow</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">background-color</span><span class="p">:</span> <span class="nb">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">background-color</span><span class="p">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span> <span class="m">0.4</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="c">/* padding-top: 60px; */</span>
<span class="p">}</span>
<span class="nc">.modal-content</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">background-color</span><span class="p">:</span> <span class="m">#fefefe</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">margin</span><span class="p">:</span> <span class="m">5%</span> <span class="nb">auto</span> <span class="m">15%</span> <span class="nb">auto</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">border</span><span class="p">:</span> <span class="m">3px</span> <span class="nb">solid</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">width</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#search-address</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">width</span><span class="p">:</span> <span class="m">80%</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#search-address-bt</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">width</span><span class="p">:</span><span class="m">20%</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.show-addresses</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">height</span><span class="p">:</span> <span class="m">250px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.over_ya</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">overflow-y</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.address-result</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.address-result</span><span class="o">,</span><span class="nc">.address-result</span> <span class="nt">th</span><span class="o">,</span><span class="nc">.address-result</span> <span class="nt">td</span><span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#bcbcbc</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="kd">function</span> <span class="nf">search_address</span><span class="p">(){</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">let</span> <span class="nx">table</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">address_table</span><span class="dl">'</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="nx">table</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">let</span> <span class="nx">scount</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">search_count</span><span class="dl">'</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="nx">scount</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;b&gt;</span><span class="dl">"</span><span class="o">+</span><span class="dl">"</span><span class="s2">&lt;/b&gt;</span><span class="dl">"</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">let</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">search-address</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nf">if</span><span class="p">(</span><span class="nx">input</span> <span class="o">==</span> <span class="dl">''</span><span class="p">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="c1">// 서버로 검색</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">const</span> <span class="nx">Http</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XMLHttpRequest</span><span class="p">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">const</span> <span class="nx">uri</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">${signUpFindAddressNum}</span><span class="dl">"</span><span class="o">+</span><span class="dl">"</span><span class="s2">?address=</span><span class="dl">"</span><span class="o">+</span><span class="nx">input</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nx">Http</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="nx">uri</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="nx">Http</span><span class="p">.</span><span class="nf">send</span><span class="p">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="nx">Http</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nf">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kd">let</span> <span class="nx">re</span> <span class="o">=</span> <span class="nx">Http</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nx">username_is_success</span> <span class="o">=</span> <span class="nx">re</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">re</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 정보 받음</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nf">if</span><span class="p">(</span><span class="nx">re</span> <span class="o">==</span> <span class="dl">""</span><span class="p">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="p">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kd">let</span> <span class="nx">split</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="dl">"</span><span class="se">\n</span><span class="dl">"</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kd">let</span> <span class="nx">cnt</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">split</span><span class="p">.</span><span class="nx">length</span><span class="o">/</span><span class="mi">3</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nx">scount</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;b&gt;</span><span class="dl">"</span><span class="o">+</span><span class="nx">cnt</span><span class="o">+</span><span class="dl">"</span><span class="s2">&lt;/b&gt;</span><span class="dl">"</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">cnt</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 정보 테이블에 표시</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// let table = document.getElementById('address_table');</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">s</span><span class="o">&lt;</span><span class="nx">cnt</span><span class="o">*</span><span class="mi">3</span><span class="p">;</span><span class="nx">s</span><span class="o">+=</span><span class="mi">3</span><span class="p">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nx">table</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="dl">"</span><span class="s2">&lt;tr&gt;</span><span class="dl">"</span><span class="o">+</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="dl">"</span><span class="s2">&lt;th&gt;</span><span class="dl">"</span><span class="o">+</span><span class="nx">split</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span><span class="o">+</span><span class="dl">"</span><span class="s2">&lt;/th&gt;</span><span class="dl">"</span><span class="o">+</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="dl">"</span><span class="s2">&lt;td&gt;&lt;a href='javascript:' onclick='select_address(this);'&gt;</span><span class="dl">"</span><span class="o">+</span><span class="nx">split</span><span class="p">[</span><span class="nx">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="dl">"</span><span class="s2">&lt;/a&gt;&lt;br&gt;&lt;a href='javascript:' onclick='select_address(this);'&gt;</span><span class="dl">"</span><span class="o">+</span><span class="nx">split</span><span class="p">[</span><span class="nx">s</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="dl">"</span><span class="s2">&lt;/a&gt;&lt;/td&gt;</span><span class="dl">"</span><span class="o">+</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="dl">"</span><span class="s2">&lt;/tr&gt;</span><span class="dl">"</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="p">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="p">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">};</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nf">select_address</span><span class="p">(</span><span class="nx">item</span><span class="p">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">let</span> <span class="nx">th</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nf">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">th</span><span class="dl">'</span><span class="p">).</span><span class="nx">innerHTML</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">let</span> <span class="nx">tb</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">address-number</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">th</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">address-text</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">tb</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">addr</span><span class="dl">'</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="o">=</span><span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nx">address_is_success</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">success</span><span class="dl">"</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">let</span> <span class="nx">table</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">address_table</span><span class="dl">'</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="nx">table</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">search-address</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">let</span> <span class="nx">scount</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">search_count</span><span class="dl">'</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="nx">scount</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;b&gt;</span><span class="dl">"</span><span class="o">+</span><span class="dl">"</span><span class="s2">&lt;/b&gt;</span><span class="dl">"</span>
<span class="p">}</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nf">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">==</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">addr</span><span class="dl">'</span><span class="p">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">addr</span><span class="dl">'</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kd">let</span> <span class="nx">table</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">address_table</span><span class="dl">'</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nx">table</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">search-address</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kd">let</span> <span class="nx">scount</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">search_count</span><span class="dl">'</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nx">scount</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;b&gt;</span><span class="dl">"</span><span class="o">+</span><span class="dl">"</span><span class="s2">&lt;/b&gt;</span><span class="dl">"</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"addr"</span> <span class="na">class=</span><span class="s">"modal"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-content"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>우편번호 검색<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"search-address"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">required</span><span class="nt">&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"search-address-bt"</span> <span class="na">href=</span><span class="s">"javascript:search_address();"</span><span class="nt">&gt;</span>검색<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;hr&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"text-align:left;"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span&gt;&lt;b&gt;</span>검색결과 : <span class="nt">&lt;/b&gt;&lt;/span&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"search_count"</span> <span class="na">style=</span><span class="s">"color:red;"</span><span class="nt">&gt;&lt;/span&gt;</span>
        <span class="nt">&lt;span&gt;&lt;b&gt;</span> 건<span class="nt">&lt;/b&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"show-addresses over_ya"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"address-result"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;thead&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">style=</span><span class="s">"width:30%"</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>우편번호<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">style=</span><span class="s">"width:70%"</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>주소<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/thead&gt;</span>
        <span class="nt">&lt;tbody</span> <span class="na">id=</span><span class="s">"address_table"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/tbody&gt;</span>
        <span class="nt">&lt;/table&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">onclick=</span><span class="s">"document.getElementById('addr').style.display='none'"</span><span class="nt">&gt;</span>Cancel<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
  
<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"border:1px solid #000000;margin:0 auto 0 auto; width: 60%;text-align: center;"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>사용자 정보 변경<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;hr&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"user-info-change"</span> <span class="na">style=</span><span class="s">"margin:0 auto 0 auto; width: 60%;text-align: left;"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"change_user_info"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label&gt;</span>아이디<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">value=</span><span class="s">"</span><span class="nt">&lt;%=</span><span class="n">user</span><span class="o">.</span><span class="na">getUsernameFilter</span><span class="o">()</span> <span class="nt">%&gt;</span><span class="s">"</span> <span class="na">disabled</span><span class="nt">&gt;&lt;br&gt;&lt;br&gt;</span>
        <span class="nt">&lt;label&gt;</span>이메일<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">value=</span><span class="s">"</span><span class="nt">&lt;%=</span><span class="n">user</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getEmail</span><span class="o">())</span> <span class="nt">%&gt;</span><span class="s">"</span><span class="nt">&gt;&lt;br&gt;&lt;br&gt;</span>
        <span class="nt">&lt;label&gt;</span>주소<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"address-number"</span> <span class="na">name=</span><span class="s">"address-number"</span> <span class="na">value=</span><span class="s">"</span><span class="nt">&lt;%=</span><span class="n">user</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getAddressNumber</span><span class="o">())</span> <span class="nt">%&gt;</span><span class="s">"</span> <span class="na">readonly</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"address-text"</span> <span class="na">name=</span><span class="s">"address"</span> <span class="na">value=</span><span class="s">"</span><span class="nt">&lt;%=</span><span class="n">user</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getAddress</span><span class="o">())</span> <span class="nt">%&gt;</span><span class="s">"</span> <span class="na">readonly</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"address-text2"</span> <span class="na">name=</span><span class="s">"address-sub"</span> <span class="na">value=</span><span class="s">"</span><span class="nt">&lt;%=</span><span class="n">user</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getAddressSub</span><span class="o">())</span> <span class="nt">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">id=</span><span class="s">"find_address_bt"</span> <span class="na">onclick=</span><span class="s">"document.getElementById('addr').style.display='block'"</span><span class="nt">&gt;</span>주소찾기<span class="nt">&lt;/button&gt;&lt;br&gt;&lt;br&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"변경하기"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;br&gt;&lt;hr&gt;&lt;br&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"change_user_pwd"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label&gt;</span>현재 비밀번호<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"pwd"</span> <span class="na">type=</span><span class="s">"password"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label&gt;</span>새로운 비밀번호<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"new-pwd"</span> <span class="na">type=</span><span class="s">"password"</span><span class="nt">&gt;&lt;br&gt;&lt;br&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"변경하기"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<h3 id="servlet-코드-1">Servlet 코드</h3>

<h4 id="mainpagejava-1">MainPage.java</h4>
<ul>
  <li>주소와 이메일 변경을 DB 에 요청한다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainPage</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span><span class="o">{</span>
<span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">uriSearch</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 마이페이지 사용자 정보 변경 페이지</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">myPageChangeInfo</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 메뉴들</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">menus</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;&gt;&gt;();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">menus</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;&gt;(</span><span class="s">"Home"</span><span class="o">,</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;(</span><span class="s">"/main_page"</span><span class="o">,</span><span class="kc">false</span><span class="o">)));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">menus</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;&gt;(</span><span class="s">"게시판"</span><span class="o">,</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;(</span><span class="n">noticeBoard</span><span class="o">+</span><span class="n">baseNoticeBoardParameter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="s">""</span><span class="o">,</span><span class="s">""</span><span class="o">,</span><span class="s">""</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="kc">false</span><span class="o">)));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">menus</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;&gt;(</span><span class="s">"버튼2"</span><span class="o">,</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;(</span><span class="s">""</span><span class="o">,</span><span class="kc">false</span><span class="o">)));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">menus</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;&gt;(</span><span class="s">"버튼2"</span><span class="o">,</span><span class="k">new</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Boolean</span><span class="o">&gt;(</span><span class="s">""</span><span class="o">,</span><span class="kc">false</span><span class="o">)));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"menus"</span><span class="o">,</span> <span class="n">menus</span><span class="o">);</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"signUpFindAddressNum"</span><span class="o">,</span> <span class="n">findAddress</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">mainPage</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>우편번호 찾기 요청을 처리한다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 우편번호 찾기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">findAddress</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">address</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"address"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 주소를 이용하여 우편 번호 찾기 시작!</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">addressDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AddressDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">addressDAO</span><span class="o">.</span><span class="na">getAddressNumber</span><span class="o">(</span><span class="n">address</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 끝</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="nc">OutputStreamWriter</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>사용자 정보 변경 요청을 처리한다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"POST"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">changeUserInfo</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"email"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">addressNumber</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"address-number"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">address</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"address"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">addressSub</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"address-sub"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="nc">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">isOK</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UsersDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">()).</span><span class="na">updateUserInfo</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getSid</span><span class="o">(),</span> <span class="n">email</span><span class="o">,</span> <span class="n">addressNumber</span><span class="o">,</span> <span class="n">address</span><span class="o">,</span> <span class="n">addressSub</span><span class="o">);</span>
  
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"요청옴 "</span><span class="o">+</span><span class="n">email</span><span class="o">+</span><span class="s">"  "</span><span class="o">+</span><span class="n">addressNumber</span><span class="o">+</span><span class="s">"  "</span><span class="o">+</span><span class="n">address</span><span class="o">+</span><span class="s">"  "</span><span class="o">+</span><span class="n">addressSub</span><span class="o">+</span><span class="s">"  "</span><span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="na">getSid</span><span class="o">());</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">isOK</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">result</span> <span class="o">=</span> <span class="s">"&lt;script&gt;alert('change success!');location.href='"</span><span class="o">+</span><span class="n">myPage</span><span class="o">+</span><span class="s">"'&lt;/script&gt;"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">else</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">result</span> <span class="o">=</span> <span class="s">"&lt;script&gt;alert('change fail!');location.href='"</span><span class="o">+</span><span class="n">myPage</span><span class="o">+</span><span class="s">"'&lt;/script&gt;"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>비밀번호 변경 요청을 처리한다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"POST"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">uri</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">changePWD</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">result</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pwd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"pwd"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">newPwd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"new-pwd"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="nc">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">isOK</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UsersDAO</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">()).</span><span class="na">updatePWD</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">pwd</span><span class="o">,</span> <span class="n">newPwd</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"비번 변경 요청 : "</span><span class="o">+</span><span class="n">pwd</span><span class="o">+</span><span class="s">"   "</span><span class="o">+</span><span class="n">newPwd</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">isOK</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">result</span> <span class="o">=</span> <span class="s">"&lt;script&gt;alert('password change success!');location.href='/user-logout'&lt;/script&gt;"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span><span class="k">else</span><span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">result</span> <span class="o">=</span> <span class="s">"&lt;script&gt;alert('password change fail!');location.href='/user-logout'&lt;/script&gt;"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">simplePage</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h4 id="usersdaojava">UsersDAO.java</h4>

<ul>
  <li>DB에 저장된 주소 및 이메일을 실질적으로 변경해준다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  

<span class="err"> </span> <span class="err"> </span> <span class="c1">// update user info</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">updateUserInfo</span><span class="o">(</span><span class="kt">long</span> <span class="n">sid</span><span class="o">,</span><span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="nc">String</span> <span class="n">addressNumber</span><span class="o">,</span> <span class="nc">String</span> <span class="n">address</span><span class="o">,</span> <span class="nc">String</span> <span class="n">addressSub</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">regexPattern</span> <span class="o">=</span> <span class="s">"^(?=.{1,64}@)[A-Za-z0-9_-]+(\\.[A-Za-z0-9_-]+)*@"</span><span class="o">+</span><span class="s">"[^-][A-Za-z0-9-]+(\\.[A-Za-z0-9-]+)*(\\.[A-Za-z]{2,})$"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(!</span><span class="n">email</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="n">regexPattern</span><span class="o">)</span> <span class="o">||</span> <span class="n">addressNumber</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)</span> <span class="o">||</span> <span class="n">address</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">addressSub</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">addressSub</span> <span class="o">=</span> <span class="s">" "</span><span class="o">;</span> <span class="c1">// 빈칸으로 db 업데이할 때 오류 발생 방지.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"update "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" set email=?, 우편번호=?, modifi_time=?, 주소=?, 주소2=? where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">connectDB</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">email</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">addressNumber</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="n">address</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="n">addressSub</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="n">sid</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>DB에 저장된 비밀번호를 실질적으로 변경해준다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UsersDAO</span> <span class="o">{</span>
<span class="o">...</span> <span class="n">생략</span> <span class="o">...</span>
<span class="err"> </span> <span class="err"> </span> <span class="c1">// update user password</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">updatePWD</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">,</span><span class="nc">String</span> <span class="n">pwd</span><span class="o">,</span> <span class="nc">String</span> <span class="n">newPwd</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">re</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">pwd</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)</span> <span class="o">||</span> <span class="n">newPwd</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 현재 비밀번호 일치하는지 확인</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">info</span> <span class="o">=</span> <span class="nc">LoginAuthentication</span><span class="o">.</span><span class="na">userAuthenticatoin</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(),</span> <span class="n">pwd</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span><span class="o">(</span><span class="n">info</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 비밀번호 변경하기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">try</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// salt 만들기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">random</span> <span class="o">=</span> <span class="nc">SecureRandom</span><span class="o">.</span><span class="na">getInstanceStrong</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">16</span><span class="o">];</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">random</span><span class="o">.</span><span class="na">nextBytes</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">salt</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="nc">Base64</span><span class="o">.</span><span class="na">getEncoder</span><span class="o">().</span><span class="na">encode</span><span class="o">(</span><span class="n">bytes</span><span class="o">));</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// 새로운 비번 sha-512 로 해시 암호화 하기</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">md</span> <span class="o">=</span> <span class="nc">MessageDigest</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"SHA-512"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">md</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">salt</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">md</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">newPwd</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">password</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%064x"</span><span class="o">,</span><span class="k">new</span> <span class="nc">BigInteger</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">md</span><span class="o">.</span><span class="na">digest</span><span class="o">()));</span>
  
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"update "</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">query</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" set salt=?, password=?, modifi_time=? where sid=?"</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">connectDB</span><span class="o">();</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">salt</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">setLong</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getSid</span><span class="o">());</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">re</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nc">Close</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">re</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<h2 id="결론">결론</h2>
<ul>
  <li>마이페이지를 만들어 db에 저장된 사용자의 정보를 보여주었다. 그리고 사용자의 정보를 업데이트할 수 있는 기능도 추가하였다.</li>
  <li>이메일, 주소, 비밀번호를 마이페이지에서 변경할 수 있다.</li>
</ul>]]></content><author><name>Jung MinGyu</name></author><category term="웹 서버" /><category term="jsp" /><category term="servlet" /><category term="oracle db" /><summary type="html"><![CDATA[사용자 정보를 수정할 수 있는 마이페이지를 만들어보자.]]></summary></entry><entry><title type="html">웹 서버의 File Upload 취약점 traversal</title><link href="http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84FileUpload%EC%B7%A8%EC%95%BD%EC%A0%90%EC%A0%9C%EA%B1%B0/" rel="alternate" type="text/html" title="웹 서버의 File Upload 취약점 traversal" /><published>2023-06-07T00:00:00+09:00</published><updated>2023-06-07T23:13:00+09:00</updated><id>http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84FileUpload%EC%B7%A8%EC%95%BD%EC%A0%90%EC%A0%9C%EA%B1%B0</id><content type="html" xml:base="http://localhost:4000/%EC%9B%B9%EC%84%9C%EB%B2%84FileUpload%EC%B7%A8%EC%95%BD%EC%A0%90%EC%A0%9C%EA%B1%B0/"><![CDATA[<h2 id="file-upload-취약점">File Upload 취약점</h2>
<ul>
  <li><strong>Traversal</strong> 우회방법을 이용하여 업로드 파일 저장 위치를 바꿀 수 있다.</li>
  <li>
    <p>정삭적으로 파일을 업로드 하였을 때.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/1f2c69a3-6014-4a81-9dc1-3869d52311cd" alt="Pasted image 20230606153031" /><br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/22372933-db5f-44f2-9469-94701b9b36b4" alt="Pasted image 20230606153110" /><br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/fe15095e-2d7c-4dde-99dc-d167e6014f5a" alt="Pasted image 20230606160012" /></p>
  </li>
  <li>
    <p>현재 디렉토리를 의미하는 <code class="language-plaintext highlighter-rouge">./</code> 를 파일 이름에 붙이고 업로드 하였을 때.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/3b16aa74-d42a-40c9-a537-1bc03ca57e82" alt="Pasted image 20230606155610" /><br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/84774942-e5ac-4a4c-8074-a3b8836ee220" alt="Pasted image 20230606155621" /><br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/d8ea09bc-f7c9-4bca-9df8-4ad43d6eeb4b" alt="Pasted image 20230606160009" /></p>
  </li>
  <li>이렇게 공격자는 마음대로 업로드 파일 저장 위치를 바꾸어 저장할 수 있다.</li>
</ul>

<h2 id="특정-문자-금지하기">특정 문자 금지하기</h2>
<ul>
  <li>업로드 파일 명에 특수문자를 사용하여 디렉토리를 옮기는 것을 막기위해 특정 특수문자를 필터링한다.</li>
  <li>즉 <code class="language-plaintext highlighter-rouge">\ , / , : , * , ? , &lt; , &gt; , | , % , " </code> 문자를 필터링 한다.</li>
  <li>다음과 같은 문자가오는 파일이름이면 서버에 저장하지 않는다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">regex</span> <span class="o">=</span> <span class="s">"[/\\\\:*?&lt;&gt;|\"%]+"</span><span class="o">;</span>
<span class="kt">var</span> <span class="n">pattern</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="n">regex</span><span class="o">);</span>
<span class="n">pattern</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">fileName</span><span class="o">).</span><span class="na">find</span><span class="o">()</span>
</code></pre></div></div>

<h2 id="구현">구현</h2>
<ul>
  <li>특정 문자가 파일이름에 들어가 있으면 업로드 파일을 서버에 저장하지 않는다.</li>
</ul>

<h3 id="mainpagejava">MainPage.java</h3>

<ul>
  <li>특수 문자 검사 함수</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err"> </span> <span class="err"> </span> <span class="c1">// true : dont save file in server</span>
<span class="err"> </span> <span class="err"> </span> <span class="c1">// false : save file in server</span>
<span class="err"> </span> <span class="err"> </span> <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">notCorrectFileName</span><span class="o">(</span><span class="nc">String</span> <span class="n">fileNmae</span><span class="o">){</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">regex</span> <span class="o">=</span> <span class="s">"[/\\\\:*?&lt;&gt;|\"%]+"</span><span class="o">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">var</span> <span class="n">pattern</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="n">regex</span><span class="o">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">pattern</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">fileNmae</span><span class="o">).</span><span class="na">find</span><span class="o">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>검사하고 싶은 파일 이름을 넣어준다. 검사를 통과해야 업로드한 파일을 서버에 저장한다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 파일 이름에 금지된 문자가 사용되면 파일 업로드 안하기.</span>
<span class="k">if</span><span class="o">(</span><span class="n">notCorrectFileName</span><span class="o">(</span><span class="n">파일</span> <span class="n">이름</span><span class="o">)){</span>
	<span class="k">continue</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="결과">결과</h2>
<ul>
  <li>burp suite 의 intercept 기능을 이용하여 파일 이름을 변경하여 서버로 요청을 보내게한다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/2894a644-59d8-4a67-950c-5911a9cddef1" alt="Pasted image 20230607170427" /></li>
  <li>게시글은 작성되지만 파일은 서버에 저장이 안되는 것을 확인할 수 있다.<br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/80c70def-c5e7-4b8c-8c5f-2a0d21035687" alt="Pasted image 20230607170507" /><br /><img src="https://github.com/MinGyu2/MinGyu2.github.io/assets/31990118/69491d41-f74f-4cb2-a4a6-78c8497a0947" alt="Pasted image 20230607172749" /></li>
</ul>]]></content><author><name>Jung MinGyu</name></author><category term="file upload" /><category term="file upload traversal" /><summary type="html"><![CDATA[웹 서버의 File Upload 취약점을 제거해 보자.]]></summary></entry></feed>